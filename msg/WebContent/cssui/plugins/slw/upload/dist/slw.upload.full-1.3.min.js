$.fn.slwUpload=$.fn.jqupload=function(a){a=new SlwPlugins.SlwUpload(this,a);a.init();return a};var SlwUpload={};SlwPlugins.SlwUpload=function(a,b){this.version="slwUpload v1.0";this.debug=!1;this.defaults={btnTitle:"\u8bf7\u9009\u62e9\u6587\u4ef6",btnAlign:"pull-left",btnClass:"btn-primary btn-sm",btnOnTop:!0,btnSortClass:"btn-default btn-sm",readonly:!1,confirm:!0,imgPreview:!1,sortable:!1,sortSaveAuto:!1,fileIcon:!0,checkUpload:!0,uploadUrl:"uploadAttachment.action",getUrl:"getAttachment.action",getCropUrl:"getCropAttachment.action",cropUrl:"cropAttachment.action",updUrl:"updAttachment.action",delUrl:"delAttachment.action",sortUrl:"sortAttachment.action",loadUrl:"loadAttachment.action",downUrl:"downloadAttachment.action",extraData:{tableName:"",tableKey:"",tableUuid:""},fileLength:1E4,fileNumber:1,allowedTypes:"*",fileExt:null,fileName:"file",dataType:"json",method:"POST",uploadType:"sync",width:140,height:180,bottom:!0,fileNameShow:!1,defaultImage:"cssui/plugins/slw/upload/style/blank.gif",style:SlwUpload.Li,onload:null,initLoadInfo:"\u52a0\u8f7d\u6210\u529f",tmplInit:null,addCallback:null,delCallback:null,extraPara:null,buttons:[]};this.option=$.extend(this.defaults,b);this.el=$(a);this.uploadArray=[]};SlwPlugins.SlwUpload.prototype={init:function(){var a=this,b=a.option;if(0!=a.el.length){var c={};if(1<a.el.length||Slw.Utils.isnull(b.extraData.tableUuid)){var d=[];a.el.each(function(){var a=$(this).attr("data-id");d.push(a);c[a]=[]});b.extraData.tableUuid=d.toString()}else c[b.extraData.tableUuid]=[];"false"!=b.checkUpload&&$.post(b.loadUrl,b.extraData,function(d){switch(d.result){case 0:var f=d.msg.config;b.fileLength=f.fileLength;b.fileNumber=f.fileNumber;b.fileExt=f.fileExt;b.extraPara=Slw.Utils.toJson(f.extraPara);f=d.msg.list;for(d=0;d<f.length;d++)c[f[d].tableUuid].push(f[d]);Slw.Utils.isnull(b.extraPara)||("pic"==b.extraPara.type?(b.width=b.extraPara.width,b.height=b.extraPara.height,b.allowedTypes="image/jpg,image/jpeg,image/png,image/gif",b.imgPreview=1==b.extraPara.imgPreview):Slw.Utils.isnull(b.extraPara)||"crop"!=b.extraPara.type||(b.width=b.extraPara.width,b.height=b.extraPara.height));f=b.extraData.tableUuid.split(",");for(d=0;d<f.length;d++)a.uploadArray[d]=new SlwUpload.Main(a,f[d],c[f[d]],a.el[d]),a.uploadArray[d].init();break;default:$css.alert(d.msg)}},b.dataType)}}};SlwUpload.Main=function(a,b,c,d){this.el=$(d);this.upload=a;this.option=a.option;this.data=c;this.extraData=$.extend(!0,{},a.option.extraData);this.extraData.tableUuid=b;this.nextIndex=this.successFiles=0;this.files;this.cropData={};this.filesMap={};this.fileModel=[];this.template=null;this.container=$('\x3cdiv class\x3d"jqupload-container"\x3e\x3c/div\x3e');this.cmd=new SlwUpload.Cmd(this);this.view=new SlwUpload.View(this);this.imgViewer=this.ieUpload=null};SlwUpload.Main.prototype={init:function(){this.template=new this.option.style(this);this.view.init();this.initRowData();this.initPlugins("init");this.initEvent()},initEvent:function(){var a=this.option;a.readonly||(Slw.Utils.isnull(a.extraPara)||"crop"!=a.extraPara.type?this.initUploadEvent():0==this.getTotalFiles()&&Slw.Utils.isIE()&&10>Slw.Utils.ieVersion()?this.initUploadEvent():this.initCropEvent(!1))},initRowData:function(){var a=this.option,b=this.data;if(0<b.length)for(var c=0;c<b.length;c++)this.readJson(b[c]);this.loadEnd();if(!Slw.Utils.isnull(a.onload))a.onload()},getTotalFiles:function(){var a=Object.keys(this.filesMap).length;"defaultImageId"in this.filesMap&&a--;return a},loadEnd:function(){this.addDefaultImage();this.resort()},addDefaultImage:function(){var a=this.option;if(1==a.fileNumber&&0==this.getTotalFiles()&&this.template.imageFlag){var b=this.filesMap.defaultImageId;Slw.Utils.isnull(b)&&(b={id:"defaultImageId",file:null,fileName:"",fileSize:"-1",category:"pic"},b.fileUrlFull=a.defaultImage,this.filesMap[b.id]=b);this.cmd.addFile(b,1)}},onlyCrop:function(){var a=this,b=this.option,c={};c.x=Math.round(cropData.e.x);c.y=Math.round(cropData.e.y);c.width=cropData.e.width;c.height=cropData.e.height;c.tSessionId=(new Date).valueOf();c=$.param($.extend(c,a.extraData));$.post(b.cropUrl,c,function(b){0==b.result?(1==a.template.background?a.template.setBackground(b.msg):a.el.find(".iconCell img").attr("src",b.msg.fileUrlFull+"."+b.msg.fileExt),$css.tip("\u4fdd\u5b58\u6210\u529f\uff01")):$css.alert(b.msg)},b.dataType)},initPlugins:function(a){this.picViewer();("init"==a||Slw.Utils.isIE()&&10>Slw.Utils.ieVersion())&&this.sortable()},picViewer:function(a){1==this.option.imgPreview&&(null==this.imgViewer?this.imgViewer=this.el.slwViewer({picTitle:"title"}):this.imgViewer.reload())},sortable:function(){var a=this.option,b=this;!a.readonly&&a.sortable&&b.template.sortable&&(a=this.el.find(".sortable"),a.sortable("destroy"),a.sortable(),a.css("cursor","move"),a.on("dragend",function(){b.resort();b.cmd.sortFiles()}))},updateTools:function(a,b){var c=this.option,d=this,f=$("#"+a).find(".toolsCell"),g=$('\x3cdiv class\x3d"tools"\x3e\x3c/div\x3e'),h=$('\x3ci class\x3d"fa fa-trash-o" title\x3d"\u5220\u9664"\x3e \x3c/i\x3e'),l=$('\x3ci class\x3d"fa fa-edit" title\x3d"\u7f16\u8f91"\x3e \x3c/i\x3e'),k=$('\x3ci class\x3d"fa fa-download" title\x3d"\u4e0b\u8f7d"\x3e \x3c/i\x3e'),m=$('\x3ci class\x3d"fa fa-reply" title\x3d"\u91cd\u4f20"\x3e \x3c/i\x3e');f.html("").append(g);1==b?(g.append(l),g.append(k),g.append(h)):2==b?((!Slw.Utils.isIE()||9<Slw.Utils.ieVersion())&&g.append(m),g.append(h)):3==b&&g.append(k);h.click(function(){d.cmd.delFile(a)});l.click(function(){d.cmd.renameFile(a)});k.click(function(){d.cmd.downloadFile(a,2)});m.click(function(){d.cmd.reupload(a)});$.each(c.buttons,function(b,c){var f=$('\x3ci class\x3d"'+c.icon+'" title\x3d"'+c.title+'"\x3e \x3c/i\x3e');g.append(f);$.isFunction(c.action)&&f.click(function(){c.action.apply(d,[d.getFileInfo(a)])})})},getFileInfo:function(a){var b=this.option;a=this.filesMap[a];Slw.Utils.isnull(b.extraPara)||(a.extraPara=b.extraPara);return a},initUploadEvent:function(){Slw.Utils.isIE()&&10>Slw.Utils.ieVersion()?this.initLessIe9Event():this.initBrowserEvent()},initLessIe9Event:function(){var a=this.option,b=this,c=$.extend({},b.extraData);c.ie="ie8";(Slw.Utils.isnull(a.extraPara)||"crop"!=a.extraPara.type)&&b.template.imageFlag&&(c.width=a.width,c.height=a.height);var d={},f=null;b.ieUpload=b.btn.slwAjaxUpload({action:a.uploadUrl,name:a.fileName,allowedTypes:a.allowedTypes,fileNumber:a.fileNumber,data:c,responseType:"json",onSubmit:function(c,h){if(null!=a.fileExt&&"*"!=a.fileExt){var g=a.fileExt.toLowerCase().split(",");if(0>$.inArray(h,g))return b.view.onFileExtError(fm.id,file,h),!1}if(0<a.fileNumber&&b.getTotalFiles()>=a.fileNumber)return $css.alert("\u6700\u591a\u5141\u8bb8\u4e0a\u4f20 "+a.fileNumber+" \u4e2a\u9644\u4ef6\uff01"),!1;d.id=Slw.Utils.uuid();d.fileExt=h;d.fileName=c.substring(0,c.lastIndexOf("."));d.fileSize=0;d.file=null;b.filesMap[d.id]=d;b.addNewFile(d);b.template.initProgress(d.id);var k=10;f=setInterval(function(){k+=Math.ceil((100-k)/10);98<k&&clearInterval(f);b.template.updateProgress(d.id,k+"%")},500);return!0},onSuccess:function(a,c){clearInterval(f);b.view.onUploadSuccess(d.id,c)},onError:function(a,c,f){b.view.onUploadError(d.id,f)},onComplete:function(c,d){Slw.Utils.isnull(a.extraPara)||"crop"!=a.extraPara.type||(this.hide(),b.initCropEvent(!0))}})},initBrowserEvent:function(){var a=this.option,b=this,c=$('\x3cinput type\x3d"file" name\x3d"'+a.name+'" style\x3d"display:none" unselectable\x3d"on" '+("*"!=a.allowedTypes?'accept\x3d"'+a.allowedTypes+'"':"")+(1!=a.fileNumber?' multiple\x3d"multiple"':" ")+"/\x3e");b.btn.after(c);b.btn.click(function(){0<a.fileNumber&&b.getTotalFiles()>=a.fileNumber?$css.alert("\u6700\u591a\u5141\u8bb8\u4e0a\u4f20 "+a.fileNumber+" \u4e2a\u9644\u4ef6\uff01"):c.click()});c.on("change",function(a){""!=c.val()&&(b.btn.attr("disabled",!0),b.processFiles(a.target.files),c.val(""))});b.btn.attr("disabled",!1)},uploadFile:function(a){var b=this.option,c=this;c.template.initProgress(a.id);var d=new FormData;d.append(b.fileName,a.file);d.append("name",a.file.name);d.append("fileType",a.file.type);Slw.Utils.isnull(b.extraPara)||"crop"!=b.extraPara.type?c.template.imageFlag&&(d.append("width",b.width),d.append("height",b.height)):(d.append("x",Math.round(cropData.e.x)),d.append("y",Math.round(cropData.e.y)),d.append("width",cropData.e.width),d.append("height",cropData.e.height));$.each(c.extraData,function(a,b){d.append(a,b)});$.ajax({url:b.uploadUrl,type:b.method,dataType:b.dataType,data:d,cache:!1,contentType:!1,processData:!1,forceSync:!1,xhr:function(){var b=$.ajaxSettings.xhr();b.upload&&b.upload.addEventListener("progress",function(b){var d=0,f=b.loaded||b.position,g=b.total||e.totalSize;b.lengthComputable&&(d=Math.ceil(f/g*100));c.template.updateProgress(a.id,d+"%")},!1);return b},success:function(b,d,h){c.view.onUploadSuccess(a.id,b)},error:function(b,d,h){c.view.onUploadError(a.id,h)},complete:function(a,d){"sync"==b.uploadType?c.syncProcessNext():c.sortable()}})},processFiles:function(a){var b=this.option;this.fileModel=[];for(var c=0;c<a.length&&!(0<b.fileNumber&&this.getTotalFiles()>=b.fileNumber);c++)this.initFileData(c,a[c]);"sync"==b.uploadType?this.syncProcess():this.asyncProcess()},initFileData:function(a,b){var c={};c.id=uuid();c.fileExt=Slw.File.getFileExt(b.name);var d=b.name.lastIndexOf(".");c.fileName=0<d?b.name.substring(0,d):b.name;c.fileSize=b.size;c.file=b;this.filesMap[c.id]=c;this.fileModel[a]=c;this.addNewFile(c)},syncProcess:function(){this.nextIndex=0;this.syncProcessNext()},syncProcessNext:function(){this.nextIndex<this.fileModel.length?this.processFile(this.fileModel[this.nextIndex++]):(this.sortable(),this.btn.attr("disabled",!1))},asyncProcess:function(){for(var a=0;a<this.fileModel.length;a++)this.processFile(this.fileModel[a]);this.btn.attr("disabled",!1)},processFile:function(a){var b=this.option,c=a.file;if("*"!=b.allowedTypes&&0>b.allowedTypes.indexOf(c.type))this.view.onFileTypeError(a.id,c);else{if(null!=b.fileExt&&"*"!=b.fileExt){var d=b.fileExt.toLowerCase().split(","),f=Slw.File.getFileExt(c.name);if(0>$.inArray(f,d)){this.view.onFileExtError(a.id,c,f);return}}if(0<b.fileLength&&c.size>1024*b.fileLength)this.view.onFileSizeError(a.id,c,1024*b.fileLength);else this.uploadFile(a)}},addNewFile:function(a){1==this.option.fileNumber&&this.template.imageFlag&&this.el.find("li").remove();this.cmd.addFile(a,0);this.resort()},initCropEvent:function(a){var b=this.option,c=this;c.btn.click(function(){var a={};a.url=b.getCropUrl;a.data=c.extraData;a.rel="getCropFile";a.title="\u56fe\u7247\u526a\u88c1";a.callback=function(){$("#getCropAttachmentForm").find(".crop-save").click(function(){cropData=$cropApp.saveClick();if(!Slw.Utils.isnull(cropData))if($css.closeDialog(),c.fileModel=[],Slw.Utils.isnull(cropData.file))c.onlyCrop();else c.initFileData(0,cropData.file),c.syncProcess()})};$css.openDialog(a)});a&&c.btn.click()},readJson:function(a){var b=this.option;a.id=Slw.Utils.uuid();a.file=null;this.filesMap[a.id]=a;this.cmd.addFile(a,1);this.updateTools(a.id,b.readonly?3:1)},resort:function(){var a=this;if(!this.option.fileIcon){var b=1;this.getBody().find(".numCell").each(function(){$(this).html(b++ +(a.template.dotFlag?".":""))})}},getBody:function(){return this.template.body},printData:function(){console.log(this.extraData);console.log(this.data);console.log(this.el[0])}};SlwUpload.Cmd=function(a){this.main=a;this.option=a.option};SlwUpload.Cmd.prototype={addFile:function(a,b){var c=this.option;this.main.template.addFile(a,b);$.isFunction(c.addCallback)&&c.addCallback.apply(this,[a,c])},delFile:function(a){var b=this.main,c=this.option,d=$("#"+a),f=function(d,f,l){delete b.filesMap[a];b.loadEnd();b.initPlugins("del");$.isFunction(c.delCallback)&&c.delCallback.apply(this,[d,c,l]);Slw.Utils.isnull(c.extraPara)||"crop"!=c.extraPara.type||0==b.getTotalFiles()&&(null!=b.ieUpload?b.ieUpload.show():Slw.Utils.isIE()&&10>Slw.Utils.ieVersion()&&b.initUploadEvent())};"1"!=d.attr("status")?(f(),d.remove()):Slw.UploadUtil.del(a,b.filesMap[a].uuid,f,c,b.extraData)},reupload:function(a){var b=this.main;a in b.filesMap&&b.processFile(b.filesMap[a])},downloadFile:function(a,b){Slw.UploadUtil.download(a,this.main.filesMap[a].uuid,b,this.option)},renameFile:function(a){var b=this.main,c=this.option,d=b.filesMap[a];$css.openDialog({title:"\u91cd\u547d\u540d",url:c.getUrl,data:{uuid:d.uuid},rel:"attachmentRename",callback:function(){var f=$("#getAttachmentForm");f.find("button").click(function(){if(!f.valid())return!1;var g=f.find("#fileName").val();$.post(c.updUrl,f.serialize(),function(c){0==c.result?($css.closeDialog(),$css.tip("\u4fdd\u5b58\u6210\u529f\uff01"),d.fileName=g,b.filesMap[a]=d,$("#"+a).find(".default-file-name").html(Slw.File.getFullName(d))):$css.alert(c.msg)},c.dataType)})}})},sortFiles:function(){var a=this.main,b=this.option,c="";a.el.find("li").each(function(){var b=$(this).attr("id");Slw.Utils.isnull(b)||(b=a.filesMap[$(this).attr("id")],c+=b.uuid+",")});if(!Slw.Utils.isnull(c)){var d=$.extend({},a.extraData);d.sortStr=c;d.tSessionId=(new Date).valueOf();$.post(b.sortUrl,d,function(a){0!=a.result&&$css.alert(a.msg)},b.dataType)}}};SlwUpload.View=function(a){this.main=a;this.option=a.option};SlwUpload.View.prototype={init:function(){var a=this.option,b=this.main;b.el.addClass("jqUploadTemplate");b.el.addClass(b.template.name);b.btnDiv=$('\x3cdiv class\x3d"'+a.btnAlign+'"\x3e\x3c/div\x3e');b.btn=$('\x3cbutton type\x3d"button" class\x3d"jquploadButton btn '+a.btnClass+" "+a.btnAlign+'"\x3e \x3ci class\x3d"fa fa-folder-open-o"\x3e\x3c/i\x3e '+a.btnTitle+"\x3c/button\x3e");b.el.html("");b.btnDiv.append(b.btn);b.el.append(b.container);a.btnOnTop?(a.readonly||b.el.append(b.btnDiv).append(b.template.getClear()),b.el.append(b.container)):(b.el.append(b.container).append(b.template.getClear()),a.readonly||b.el.append(b.btnDiv));b.container.append(b.template.createBody());b.template.init();b.btnDiv.hasClass("center-block")&&(8!=Slw.Utils.ieVersion()&&9!=Slw.Utils.ieVersion()||b.btnDiv.css("display","table"))},updateMessage:function(a,b,c){c=$('\x3ccode class\x3d"tipsCell" text-red"\x3e'+c+"\x3c/code\x3e");var d=$("#"+a).find(".messageCell");d.find(".tipsCell").remove();d.append(c);"danger"==b&&this.main.template.updateStatus(a,b,"\u4e0a\u4f20\u5931\u8d25")},clearTips:function(a){$("#"+a).find(".toolsCell").html("");$("#"+a).find(".tipsCell").remove()},onFileTypeError:function(a,b){this.onUploadError(a,"\u4e0d\u5141\u8bb8\u4e0a\u4f20\u8be5\u7c7b\u578b\u6587\u4ef6")},onFileExtError:function(a,b,c){this.onUploadError(a,"\u6587\u4ef6\u6269\u5c55\u540d(."+c+")\u7c7b\u578b\u4e0d\u5141\u8bb8")},onFileSizeError:function(a,b,c){this.onUploadError(a,"\u6587\u4ef6\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7"+Slw.File.getFileSize(c))},onUploadSuccess:function(a,b){var c=this.main;if(0==b.result){$("#"+a).attr("status",1);this.main.template.updateStatus(a,"success","\u4e0a\u4f20\u6210\u529f");c.filesMap[a].uuid=b.msg.uuid;c.filesMap[a].fileUrlFull=b.msg.fileUrlFull;c.filesMap[a].time=b.msg.time;c.filesMap[a].userId=b.msg.userId;c.filesMap[a].file=null;if(Slw.Utils.isIE()&&10>Slw.Utils.ieVersion()){c.filesMap[a].fileSize=b.msg.fileSize;var d=$("#"+a).find(".default-file-size");if(d){var f=d.html();Slw.Utils.isnull(f)?d.html(Slw.File.getFileSize(c.filesMap[a].fileSize)):d.html("("+Slw.File.getFileSize(c.filesMap[a].fileSize)+")")}}this.main.updateTools(a,1);this.main.template.uploadSuccess(a,b);this.main.initPlugins("upload")}else this.onUploadError(a,b.msg)},onUploadError:function(a,b){$("#"+a).attr("status",2);this.updateMessage(a,"danger",b);this.main.updateTools(a,2)}};SlwUpload.Tmpl=function(a){this.main=a};SlwUpload.Tmpl.prototype={init:function(){var a=this.getOption();$.isFunction(a.tmplInit)&&a.tmplInit.apply(this,[])},getOption:function(){return this.main.upload.option},getClear:function(){return'\x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e'},createBody:function(){return this.body},updateStatus:function(a,b,c){a=$("#"+a).find(".statusCell");a.html("");a.append('\x3cspan class\x3d"label label-'+b+'"\x3e'+c+"\x3c/span\x3e")},initProgress:function(a){$("#"+a).find(".statusCell").html('\x3cdiv class\x3d"progress"\x3e\x3cdiv class\x3d"progress-bar" role\x3d"progressbar" style\x3d"min-width:3em;"\x3e0%\x3c/div\x3e\x3c/div\x3e');this.main.view.clearTips(a)},updateProgress:function(a,b){var c=$("#"+a).find("div.progress-bar");c.width(b);c.html(b)},uploadSuccess:function(){}};liMethod=SlwUpload.Li=function(a){this.main=a;this.name="liTemplate";this.dotFlag=this.sortable=!0;this.body=$('\x3cul class\x3d"sortable"\x3e\x3c/ul\x3e')};SlwUpload.Li.prototype=new SlwUpload.Tmpl;$.extend(SlwUpload.Li.prototype,{addFile:function(a,b){var c=this.getOption(),d='\x3cli id\x3d"'+a.id+'" class\x3d"jquploadRow"\x3e',d=c.fileIcon?d+('\t\x3cspan class\x3d"iconCell"\x3e'+Slw.UploadUtil.getIconImg(a,56)+"\x3c/span\x3e"):d+'\t\x3cspan class\x3d"numCell"\x3e\x3c/span\x3e',d=d+('\t\t\x3cspan class\x3d"messageCell"\x3e\x3cspan class\x3d"default-file-name"\x3e'+Slw.File.getFullName(a)+'\x3c/span\x3e \x3cspan class\x3d"default-file-size"\x3e('+Slw.File.getFileSize(a.fileSize)+")\x3c/span\x3e\x3c/span\x3e");c.readonly||(d+='\t\x3cspan class\x3d"statusCell"\x3e');""!=c.initLoadInfo&&(d+=' \x3cspan class\x3d"label label-info"\x3e'+(1==b?c.initLoadInfo:"\u521d\u59cb\u6210\u529f")+"\x3c/span\x3e");c=$(d+'\t\t\x3c/span\x3e\x3cspan class\x3d"toolsCell"\x3e\x3c/span\x3e\t\x3c/li\x3e');c.attr("status",b);this.body.prepend(c)}});simpleLiMethod=SlwUpload.SimpleLi=function(a){this.main=a;this.name="simpleLiMethod";this.dotFlag=this.sortable=!1;this.body=$("\x3cul\x3e\x3c/ul\x3e")};SlwUpload.SimpleLi.prototype=new SlwUpload.Tmpl;$.extend(SlwUpload.SimpleLi.prototype,{addFile:function(a,b){this.getOption();var c;c='\x3cli id\x3d"'+a.id+'" class\x3d"jquploadRow"\x3e\t  \x3cspan class\x3d"statusCell"\x3e\x3c/span\x3e';c=$(c+'\t\t\x3cspan class\x3d"toolsCell"\x3e\x3c/span\x3e\t\x3c/li\x3e');c.attr("status",b);this.body.prepend(c)},getClear:function(){return""}});picMethod=SlwUpload.Pic=function(a){this.main=a;this.name="picTemplate";this.imageFlag=this.dotFlag=this.sortable=!0;this.body=$('\x3cul class\x3d"sortable"\x3e\x3c/ul\x3e')};SlwUpload.Pic.prototype=new SlwUpload.Tmpl;$.extend(SlwUpload.Pic.prototype,{init:function(){this.main.btn.addClass("btnUpload")},addFile:function(a,b){var c=this.getOption(),d=this,f;f='\x3cli id\x3d"'+a.id+'" class\x3d"jquploadRow"\x3e\x3cdiv class\x3d"imgPreview"\x3e\x3cdiv class\x3d"details"\x3e'+('\t\t\x3cdiv class\x3d"default-file-name"\x3e'+Slw.File.getFullName(a)+"\x3c/div\x3e");f+='\t\t\x3cdiv class\x3d"default-file-size"\x3e'+Slw.File.getFileSize(a.fileSize)+"\x3c/div\x3e";f="pic"==a.category?f+('\t\t\x3cdiv class\x3d"iconCell"\x3e'+Slw.UploadUtil.getUrlImg(a)+"\x3c/div\x3e"):f+('\t\t\x3cdiv class\x3d"iconCell"\x3e'+Slw.UploadUtil.getIconImg(a,256)+"\x3c/div\x3e");c.readonly||(f+='\t\x3cdiv class\x3d"statusCell"\x3e\x3c/div\x3e');f=$(f+'\t\t\x3cdiv class\x3d"messageCell"\x3e\x3c/div\x3e\t\t\x3cdiv class\x3d"toolsCell"\x3e\x3c/div\x3e\t\t\x3cdiv class\x3d"successMark"\x3e\x3ci class\x3d"fa fa-check"\x3e \x3c/i\x3e\x3c/div\x3e\t\t\x3cdiv class\x3d"dangerMark"\x3e\x3ci class\x3d"fa fa-close"\x3e \x3c/i\x3e\x3c/div\x3e\t\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e');f.attr("status",b);d.body.prepend(f);Slw.Utils.isIE()&&6==Slw.Utils.ieVersion()&&f.css({width:c.width+"px",height:c.height+"px"});f.find(".details").css({width:c.width+"px",height:c.height+"px","margin-bottom":c.bottom?"22px":"0px"});f.find(".statusCell").css({top:c.height+"px"});Slw.Utils.isIE()&&f.css({"margin-bottom":"5px"});c.bottom||f.find(".default-file-size").css("display","none");1==c.fileNumber&&"center-block"==c.btnAlign&&d.body.find("li").css("float","none");c.readonly||1!=c.fileNumber||"defaultImageId"!=a.id||(c=f.find("img"),c.css("cursor","pointer"),c.click(function(){d.body.find("input[name\x3d'"+o.fileName+"']").click()}));null!=a.file&&Slw.UploadUtil.getLocalImg(f.find("img"),a.file)},updateStatus:function(a,b,c){var d=this.main;$("#"+a).find(".statusCell").hide();var f=$("#"+a).find("."+b+"Mark"),g=$("#"+a).find(".tipsCell").html(),g=c+(Slw.Utils.isnull(g)?"":"\uff1a"+g);f.attr("title",g);"danger"==b?(f.css("cursor","pointer"),f.show(),f.click(function(){d.cmd.delFile(a)})):f.show().delay(8E3).hide(1E3)},initProgress:function(a){$("#"+a).find(".successMark, .dangerMark").hide();var b=$("#"+a).find(".statusCell");b.html('\x3cdiv class\x3d"progress progress-xs"\x3e\x3cdiv class\x3d"progress-bar progress-bar-success progress-bar-striped" role\x3d"progressbar" \x3e0%\x3c/div\x3e\x3c/div\x3e');b.show();this.main.view.clearTips(a)},updateProgress:function(a,b){var c=$("#"+a).find("div.progress-bar");c.width(b);c.html("")},uploadSuccess:function(a,b){var c=this.main,d=b.msg.fileUrlFull+"."+b.msg.fileExt;1==this.background?c.btn.css({background:"#fff url("+d+") no-repeat"}):(c=$("#"+a).find(".iconCell img"),c.attr("src",d),c.attr("class","pic-element"),c.attr("data-original",b.msg.fileUrlFull))}});simplePicMethod=SlwUpload.SimplePic=function(a){this.main=a;this.name="simplePicMethod";this.dotFlag=this.sortable=!1;this.background=this.imageFlag=!0;this.body=$("\x3cul\x3e\x3c/ul\x3e")};SlwUpload.SimplePic.prototype=new SlwUpload.Pic;$.extend(SlwUpload.SimplePic.prototype,{init:function(){var a=this.getOption(),b=this.main.btn;a.defaultBackground=b.css("background-image");a.defaultFilter=b.css("filter");b.css({width:a.width,height:a.height})},addFile:function(a,b){this.getOption();var c;c='\x3cli id\x3d"'+a.id+'" class\x3d"jquploadRow"\x3e\t  \x3cspan class\x3d"statusCell"\x3e\x3c/span\x3e';c=$(c+'\t\t\x3cspan class\x3d"toolsCell"\x3e\x3c/span\x3e\t\x3c/li\x3e');c.attr("status",b);this.body.prepend(c);this.setBackground(a)},setBackground:function(a){var b=this.getOption(),c=this.main.btn,d=b.defaultBackground;"defaultImageId"!=a.id&&a.fileUrlFull&&(d="url("+a.fileUrlFull+"."+a.fileExt+")");Slw.Utils.isIE()&&9>Slw.Utils.ieVersion()&&"defaultImageId"==a.id?c.css({background:"none",filter:b.defaultFilter}):c.css({"background-image":d,"background-size":b.width+"px "+b.height+"px",filter:"none"})}});tableMethod=SlwUpload.Table=function(a){this.main=a;this.name="tableTemplate";this.sortable=!0;this.dotFlag=!1;this.table;this.body=$('\x3ctbody class\x3d"sortable"\x3e\x3c/tbody\x3e')};SlwUpload.Table.prototype=new SlwUpload.Tmpl;$.extend(SlwUpload.Table.prototype,{createBody:function(){var a=this.getOption(),b;b='\x3ctable class\x3d"table table-bordered table-striped"\x3e\t\t\x3cthead\x3e\x3ctr\x3e'+('\t\t\x3cth width\x3d"45px" class\x3d"firstCell"\x3e'+(a.fileIcon?"\u7c7b\u578b":"\u5e8f\u53f7")+"\x3c/th\x3e");b+="\t\t\x3cth\x3e\u6587\u4ef6\u540d\u79f0\x3c/th\x3e";a.readonly||(b+='\t\t\x3cth width\x3d"70px"\x3e\u72b6\u6001\x3c/th\x3e');b=b+('\t\t\x3cth width\x3d"'+(25+18*((a.readonly?1:3)+a.buttons.length))+'px"\x3e\u64cd\u4f5c\x3c/th\x3e')+"\t\t\x3c/tr\x3e\x3c/thead\x3e";this.table=$(b+"\t\x3c/table\x3e");this.table.append(this.body);return this.table},addFile:function(a,b){var c=this.getOption(),d=$('\x3ctr id\x3d"'+a.id+'" class\x3d"jquploadRow" status\x3d"'+b+'"\x3e\x3c/tr\x3e');c.fileIcon?d.append('\x3ctd class\x3d"iconCell"\x3e'+Slw.UploadUtil.getIconImg(a,56)+"\x3c/td\x3e"):d.append('\x3ctd class\x3d"numCell"\x3e\x3c/td\x3e');d.append('\x3ctd class\x3d"text-left messageCell"\x3e\x3cspan class\x3d"default-file-name"\x3e'+Slw.File.getFullName(a)+'\x3c/span\x3e \x3cspan class\x3d"default-file-size"\x3e('+Slw.File.getFileSize(a.fileSize)+")\x3c/span\x3e\x3c/td\x3e");c.readonly||d.append('\x3ctd class\x3d"statusCell"\x3e\x3cspan class\x3d"label label-info"\x3e'+(1==b?"\u52a0\u8f7d":"\u521d\u59cb")+"\u6210\u529f\x3c/span\x3e\x3c/td\x3e");d.append('\x3ctd class\x3d"toolsCell"\x3e\x3c/td\x3e');this.body.prepend(d)}});tableMethod2=SlwUpload.Table2=function(a){this.main=a;this.name="tableTemplate2";this.sortable=!0;this.dotFlag=!1;this.table;this.body=$('\x3ctbody class\x3d"sortable"\x3e\x3c/tbody\x3e')};SlwUpload.Table2.prototype=new SlwUpload.Tmpl;$.extend(SlwUpload.Table2.prototype,{createBody:function(){var a=this.getOption(),b;b='\x3ctable class\x3d"table table-bordered table-striped"\x3e\t\t\x3cthead\x3e\x3ctr\x3e'+('\t\t\x3cth width\x3d"45px" class\x3d"firstCell"\x3e'+(a.fileIcon?"\u7c7b\u578b":"\u5e8f\u53f7")+"\x3c/th\x3e");b=b+"\t\t\x3cth\x3e\u6587\u4ef6\u540d\u79f0\x3c/th\x3e"+('\t\t\x3cth width\x3d"'+(25+18*((a.readonly?1:3)+a.buttons.length))+'px"\x3e\u64cd\u4f5c\x3c/th\x3e')+"\t  \x3c/tr\x3e\x3c/thead\x3e";this.table=$(b+"\t\x3c/table\x3e");this.table.append(this.body);return this.table},addFile:function(a,b){var c=this.getOption(),d=$('\x3ctr id\x3d"'+a.id+'" class\x3d"jquploadRow" status\x3d"'+b+'"\x3e\x3c/tr\x3e');c.fileIcon?d.append('\x3ctd class\x3d"iconCell"\x3e'+Slw.UploadUtil.getIconImg(a,56)+"\x3c/td\x3e"):d.append('\x3ctd class\x3d"numCell"\x3e\x3c/td\x3e');var f='\x3cspan class\x3d"default-file-name"\x3e'+Slw.File.getFullName(a)+'\x3c/span\x3e \x3cspan class\x3d"default-file-size"\x3e('+Slw.File.getFileSize(a.fileSize)+")\x3c/span\x3e";c.readonly||(f+='\x3cspan class\x3d"statusCell"\x3e\x3cspan class\x3d"label label-info"\x3e'+(1==b?"\u52a0\u8f7d":"\u521d\u59cb")+"\u6210\u529f\x3c/span\x3e\x3c/span\x3e");d.append('\x3ctd class\x3d"text-left messageCell"\x3e'+f+"\x3c/td\x3e");d.append('\x3ctd class\x3d"toolsCell"\x3e\x3c/td\x3e');this.body.prepend(d)}});SlwUpload.TableNormal=function(a){this.main=a;this.name="noStyle";this.dotFlag=this.sortable=!1;this.table;this.body=$("\x3ctbody\x3e\x3c/tbody\x3e")};SlwUpload.TableNormal.prototype=new SlwUpload.Tmpl;$.extend(SlwUpload.TableNormal.prototype,{createBody:function(){return""},addFile:function(a,b){var c=this.getOption(),d=this.main,f=a.id,g=this.body,h;h=g[0].insertRow(0);h.id=f;h.className="fileRow";h.setAttribute("status",b);h.setAttribute("data-key",d.extraData.tableKey);f=0;d=h.insertCell(f++);c.fileIcon?(d.className="text-center icon",d.innerHTML=Slw.UploadUtil.getIconImg(a,48)):(d.className="numCell",g.find(".firstCell").html("\u5e8f\u53f7"),d.innerHTML=g[0].rows.length-1);d=h.insertCell(f++);d.className="text-left chWord";g='\x3cspan class\x3d"default-file-name"\x3e'+Slw.File.getFullName(a)+"\x3c/span\x3e ";c.readonly||(g+='\x3cspan class\x3d"statusCell"\x3e\x3cspan class\x3d"label label-info"\x3e'+(1==b?"\u52a0\u8f7d":"\u521d\u59cb")+"\u6210\u529f\x3c/span\x3e\x3c/span\x3e");d.innerHTML=g+'\x3cspan class\x3d"toolsCell"\x3e\x3c/span\x3e';d=h.insertCell(f++);d.className="text-center chWord";d.innerHTML=Slw.UploadUtil.formatDate(Slw.UploadUtil.currentDate(),2,16);d=h.insertCell(f++);d.className="text-center fileType chWord";d.innerHTML=a.fileExt;d=h.insertCell(f++);d.className="text-center size chWord";d.innerHTML='\x3cspan class\x3d"default-file-size"\x3e'+Slw.File.getFileSize(a.fileSize)+"\x3c/span\x3e"}});(function(a){var b,c,d,f={},g={};$cropApp={checkPos:function(a){return isnull(g)?!0:g.x==a.x&&g.y==a.y&&g.width==a.width&&g.height==a.height?!1:!0},saveClick:function(){var a=d.getCropPos();if(0>a.x||0>a.y)return $css.alert("\u526a\u88c1\u6846\u4e0d\u8981\u8d85\u51fa\u56fe\u7247\uff01"),null;f.e=a;f.file=d.getFile();return null!=f.file||$cropApp.checkPos(a)?f:($css.closeDialog(),$css.tip("\u4fdd\u5b58\u6210\u529f"),null)},options:{extraPara:null,extraData:null,cropForm:null,cropPreview:null},init:function(f){var h=f.extraPara,k=f.extraData;b=a(f.cropForm);c=b.find(f.cropPreview);g=k;isnull(h.previewWidth)&&$css.alert("\u53c2\u6570\u914d\u7f6e\u9519\u8bef",$css.closeDialog());for(f=0;f<h.previewWidth.length;f++)b.find(".crop-preview.preview"+f).css({width:h.previewWidth[f]+"px",height:.01*Math.ceil(h.previewWidth[f]*h.height*100/h.width)+"px"});for(;3>f;f++)b.find(".preview"+f).remove();d=b.find(".crop-wrapper img").jqcropper({aspectRatio:h.width/h.height,preview:c,pos:g})}}})(jQuery);