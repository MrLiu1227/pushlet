var SlwGrid={},$SlwGrid={grid:null};(function(){$.fn.slwGrid=function(a){a=new SlwPlugins.SlwGrid(this,a);a.init();return a};SlwPlugins.SlwGrid=function(a,b){this.version="slwGrid v1.0";this.debug=!1;this.defaults={data:null,formId:null,indexStart:0,idName:"uuid",container:"box-body",scrollDiv:".l-autoscroll",scrollOffsetTop:15,scrollOffsetBottom:60,paramName:"jsonData",autoAddRow:!0,contextMenu:!0,columnResize:!1,dictArray:[],columns:[],rows:[],afterColumnResize:null,afterChange:null,init:null};this.option=$.extend(this.defaults,b);this.table=$(a);this.dataIndex="col";this.editable=!0;this.cols=this.rows=0;this.preCol=this.preRow=-1;this.curCol=this.curRow=0;this.srcArray=new SlwGrid.Data;this.curArray=new SlwGrid.Data;this.delData={};this.editCols={};this.isFocus=!1;this.trs=null;this.gridClass="slwGridInput";this.textarea=$('\x3ctextarea class\x3d"'+this.gridClass+'"\x3e\x3c/textarea\x3e');this.textInput=$('\x3cinput class\x3d"'+this.gridClass+'"\x3e\x3c/input\x3e');this.hiddenInput=$('\x3ctextarea type\x3d"text" class\x3d"slwGridHiddenInput'+(this.debug?"2":"")+'"\x3e\x3c/textarea\x3e');this.borderPos={};this.pos={};this.initEventFlag=this.pressShift=this.pressCtrl=this.removeFlag=!1;this.cfgHelper=new SlwGrid.Config(this);this.zHistory=new SlwGrid.History(this);this.yHistory=new SlwGrid.History(this);this.zHistory.hisObject=this.yHistory;this.yHistory.hisObject=this.zHistory;this.ctxMenu=new SlwGrid.CtxMenu(this);this.formula=new SlwGrid.Formula(this);this.clipboard=new SlwGrid.Clipboard(this);this.selection=new SlwGrid.Selection(this);this.resizer=new SlwGrid.Resizer(this);this.keyboard=new SlwGrid.Keyboard(this);this.validator=new SlwGrid.Validator(this);this.newRowExceptCol={};this.beforeEl=this.textarea[0]};SlwPlugins.SlwGrid.prototype={init:function(){var a=this;$SlwGrid.grid=a;a.isColIndex()||(a.option.contextMenu=!1,a.option.autoAddRow=!1);a.table.addClass("slwGrid");a.table.after(a.textarea);a.table.after(a.textInput);a.table.after(a.hiddenInput);a.ctxMenu.init();a.clipboard.init();a.selection.init();a.resizer.init();a.validator.init();(Slw.Utils.isIE()||Slw.Utils.isEdge())&&a.hiddenInput.css({"font-size":"0px"});0<a.option.columns.length?a.cfgHelper.init(a.option.columns):(a.dataIndex="row",a.cfgHelper.init(a.option.rows));a.editCols=a.cfgHelper.configs;a.table.find("thead tr").eq(0).find("th").each(function(){var b=$(this).attr("colspan");Slw.Utils.isUndefined(b)&&(b=1);a.cols+=parseInt(b)});a.refreshTrs();Slw.Dict.loadDict(a.cfgHelper.dictArray,function(){null==a.option.data?(a.loadTableData(),a.loadGridData(!1)):$.isArray(a.option.data)?(a.srcArray.data=a.option.data.concat(),a.loadGridData(!0)):a.submit({})})},reload:function(){this.hideEditor();this.selection.hideAll();this.delData={};this.pressShift=this.pressCtrl=this.removeFlag=this.isFocus=!1;this.isColIndex()&&this.getTBody().html("")},loadGridData:function(a){if(this.option.autoAddRow){var b=this.initNewData();this.srcArray.data.push(b)}for(b=0;b<this.srcArray.size();b++)this.createRowId(this.srcArray.get(b));this.curArray.data=this.srcArray.cloneAll();if(a)for(b=0;b<this.srcArray.size();b++)this.addRow(b,!1);this.refreshAll(0,a);this.initEvent();$.isFunction(this.option.init)&&this.option.init.apply(this)},getTBody:function(){return this.table.find("tbody")},getTBodyTrs:function(){return this.table.find("tbody tr")},getTFoot:function(a,b){return this.table.find("tfoot tr").eq(a).find("td").eq(b)},query:function(){var a=$("#"+this.option.formId).serialize();this.submit(a);return!1},submit:function(a){var b=this;b.reload();$.post(b.option.data,a,function(a){b.srcArray.data=a;b.loadGridData(!0)},"json")},isColIndex:function(){return"col"==this.dataIndex},getDataIndex:function(a,b){Slw.Utils.isUndefined(a)&&(a=this.curRow,b=this.curCol);return this.isColIndex()?a:b-this.option.indexStart},getCurConfig:function(a,b){Slw.Utils.isUndefined(a)&&(a=this.curRow,b=this.curCol);if(this.isColIndex()||!(b<this.option.indexStart||b>=this.option.indexStart+this.getDataRows())){var c=this.isColIndex()?b:a;return this.cfgHelper.getConfig(c)}},getEditor:function(){var a=this.getCurConfig();return a?a.editor:null},initNewData:function(){var a={},b;for(b in this.editCols){var c=this.cfgHelper.getConfig(b);c&&c.name&&(a[c.name]=c.defaultValue)}this.createUuid(a);return a},createRowId:function(a){a.slwRowId=Slw.Utils.uuid()},createUuid:function(a){this.createRowId(a);a[this.option.idName]=""},copyUuid:function(a,b){b[this.option.idName]=a[this.option.idName];b.slwRowId=a.slwRowId},loadTableData:function(){var a=this;if(this.isColIndex())a.trs.each(function(){var b=a.getDataFromTd(a,$(this));a.srcArray.data.push(b)});else for(var b=a.option.indexStart;b<a.cols;b++){var c=a.getDataFromTd(a,null,b);a.srcArray.data.push(c)}},getDataFromTd:function(a,b,c){var d={};if(null!=b){var e=b.attr("slwid");Slw.Utils.isUndefined(e)||(d[a.option.idName]=e)}for(var f in a.editCols)if(e=a.cfgHelper.getConfig(f),!Slw.Utils.isUndefined(e)){var g=null!=b?b:a.trs.eq(f);d[e.name]=e.editor.getCellData(g,null!=b?f:c)}return d},setEditable:function(a){this.editable=a;this.hideEditor()},getDataRows:function(){return this.option.autoAddRow?this.srcArray.size()-1:this.srcArray.size()},copyRows:function(a,b){b==this.rows-1&&this.option.autoAddRow&&b--;return b<a?null:this.curArray.cloneArray(a,b)},afterEdit:function(a,b,c){for(var d in this.editCols){var e=this.cfgHelper.getConfig(d);e&&("cell"==e.refresh&&this.refreshCell(e,this.getDataIndex(a,b)),this.rows>=this.curArray.size()&&("column"==e.refresh&&this.refreshColumn(e,a,b),e.formula&&this.formula.run(e)))}$.isFunction(this.option.afterChange)&&this.option.afterChange.apply(this,[a,b,c])},refreshAll:function(a,b){a||(a=0);var c=this.getDataRows(),d;for(d in this.editCols){var e=this.cfgHelper.getConfig(d);if(e&&"cell"==e.refresh||0==b&&"checkbox"==e.type)for(var f=a;f<c;f++)this.refreshCell(e,f)}for(d in this.editCols)if(e=this.cfgHelper.getConfig(d))"column"==e.refresh&&this.refreshColumn(e,a),e.formula&&this.formula.run(e)},refreshCell:function(a,b){a.name&&(a.valueRender&&a.editor.setValueByRender(this.curArray.get(b),b),this.setHtml(a,b))},refreshColumnCell:function(a,b){if(a){Slw.Utils.isUndefined(b)&&(b=0);for(var c=this.getDataRows(),d=b;d<c;d++)this.refreshCell(a,d)}},refreshColumn:function(a,b,c){$.isFunction(a.valueRender)&&a.valueRender.apply(this,[a,b,c])},isNewRowNoChange:function(a){var b=this.curArray.get(a);if(!this.isNewRow(a)||a>=this.rows-1)return!1;var c=!0,d;for(d in this.editCols){var e=this.cfgHelper.getConfig(d);if(e&&e.name&&!(e.name in this.newRowExceptCol)&&b[e.name]!=this.srcArray.getData(a,e.name)){c=!1;break}}return c},isNewRow:function(a){return""==this.curArray.getData(a,this.option.idName)},removeEmptyFromRow:function(a){this.isFocus=!1;for(var b=this.getDataRows()-1;b>a-1;b--)this.isNewRowNoChange(b)&&this.removeRows(b,b)},removeEmptyRow:function(a){this.removeFlag=!0;this.removeRows(a,a);0<this.curRow&&this.curRow--},rowChanged:function(a){return!Slw.Utils.isEqual(this.srcArray.get(a),this.curArray.get(a))},checkChanged:function(a){this.isNewRowNoChange(a)?this.removeEmptyRow(a):a==this.rows-1&&this.option.autoAddRow&&this.editable&&this.rowChanged(a)&&this.createNewRow()},checkAllChanged:function(){Slw.Utils.isEqual(this.srcArray.data,this.curArray.data)},createNewRow:function(a){var b=this.initNewData();this.srcArray.data.push(b);b=$.extend(!0,{},b);this.curArray.data.push(b);this.addRow(this.rows,a)},removeRow:function(a){a=$(a).parents("tr").index();this.delRows(a,a,this.zHistory)},delRows:function(a,b,c){this.hideAll();b=this.removeRows(a,b);null!=b&&c.setHistory("del",a,0,b)},hideAll:function(){this.hideEditor();this.selection.hideAll()},removeRows:function(a,b){b==this.rows-1&&this.option.autoAddRow&&b--;if(b<a)return null;for(var c=b-a+1,d=b;d>=a;d--)this.isNewRow(d)||(this.delData[this.srcArray.data[d].slwRowId]=this.srcArray.data[d]),this.trs.eq(d).remove();d=[];d[0]=this.srcArray.remove(a,c);d[1]=this.curArray.remove(a,c);this.refreshTrs();this.afterEdit(a);return d},cutRows:function(a,b){var c=a.data.fromRow,d=a.data.num,e=a.row;if(!(e>=c&&e<=c+d)){var f=this.srcArray.remove(c,d),g=this.curArray.remove(c,d),h=e<c?e:e-d;this.srcArray.add(h,f);this.curArray.add(h,g);for(f=d-1;0<=f;f--)g=e<c?this.getTBodyTrs().eq(c+d-1):this.getTBodyTrs().eq(c),this.getTBodyTrs().eq(e).before(g);this.refreshTrs();f={};f.num=d;e<c?(this.afterEdit(e),f.fromRow=e,b.setHistory("cut",c+d,0,f)):(this.afterEdit(c),f.fromRow=e-d,b.setHistory("cut",c,0,f))}},addRows:function(a,b){this.hideAll();this.srcArray.add(a.row,a.data[0]);this.curArray.add(a.row,a.data[1]);for(var c=a.row;c<a.row+a.data[0].length;c++)this.addRow(c,!1),this.isNewRow(c)||delete this.delData[this.srcArray.data[c].slwRowId];this.afterEdit(a.row);b.setHistory("add",a.row,0,a.data)},addRow:function(a,b){this.isColIndex()?this.addColIndex(a):this.addRowIndex(a);(Slw.Utils.isUndefined(b)||1==b)&&this.afterEdit(a)},addRowIndex:function(a){for(var b=0;b<this.rows;b++){var c=this.getTdByRow(b,a+this.option.indexStart);this.initTd(c,a,b)}},addColIndex:function(a){for(var b=this.curArray.get(a)[this.option.idName],b=$('\x3ctr slwid\x3d"'+b+'"\x3e\x3c/tr\x3e'),c=0;c<this.cols;c++){var d=$("\x3ctd\x3e\x3c/td\x3e");b.append(d);this.initTd(d,a,c)}0==a?this.getTBody().prepend(b):this.getTBodyTrs().eq(a-1).after(b);this.refreshTrs()},initTd:function(a,b,c){c=this.cfgHelper.getConfig(c);var d="",e="";c&&(Slw.Utils.isUndefined(c.tdClass)||(d=c.tdClass),e=c.editor.getHtml(b));""!=d&&(a.addClass(d),a.removeClass("text-left text-center text-right text-top text-middle text-bottom"));a.addClass("text-"+c.alignArray[0]+" text-"+c.alignArray[1]);a.html(e)},resetBeforeEl:function(){this.beforeEl=this.textarea[0]},tBodyEvent:function(){var a=this;a.option.contextMenu&&a.ctxMenu.showMenu(this.table.find("tbody"));this.table.find("tbody").on("mousedown",function(b){if(a.editable&&Slw.Event.checkHover(b,a.beforeEl)){a.beforeEl=b.target;var c=$(a.beforeEl);"TD"!=c[0].tagName&&(c=c.parent("td"));var d=c.parent().index(),e=c.index();2==b.button&&a.selection.inSelectionArea(d,e)||(a.setCellData(),a.pressShift?(a.selection.shiftDraw(d,e),a.hiddenInputMoveTo(c)):(a.preRow=a.curRow,a.preCol=a.curCol,a.tBodyMouseMove(),a.moveBorder(d,e)))}})},tBodyMouseMove:function(){var a=this;a.table.find("tbody").on("mousemove.slwGridSel",function(b){Slw.Event.checkHover(b,a.beforeEl)&&(a.beforeEl=b.target,b=$(a.beforeEl),"TD"!=b[0].tagName&&(b=b.parent("td")),a.selection.beginDraw(b,"move"))});$(document).on("mouseup.slwGridSel",function(b){a.table.find("tbody").unbind("mousemove.slwGridSel");$(document).unbind("mouseup.slwGridSel");a.selection.checkTwiceClick()})},initEvent:function(){if(!this.initEventFlag){this.initEventFlag=!0;var a=this;$(window).on("resize.slwGrid",function(b){a.moveBorder()});a.textInput.keydown(function(b){13==b.keyCode&&(b.preventDefault(),b.keyCode=40);a.keyboard.moveEvent(b,this)});a.textarea.keydown(function(b){a.keyboard.moveEvent(b,this)});a.keyboard.inputEvent();a.table.find("thead, tfoot").click(function(b){a.setCellData();a.hiddenInput.focus()});a.table.parents("."+a.option.container).click(function(b){b=a.table[0].compareDocumentPosition(b.target);20!=b&&4!=b&&(a.setCellData(),a.pressCtrl=!1,a.pressShift=!1,a.selection.hideAll(),a.hiddenInput.val(""),a.hiddenInput.focus())});a.tBodyEvent()}},refreshTrs:function(){this.trs=this.getTBodyTrs();this.rows=this.trs.size()},textObjectFocus:function(a){var b=this;setTimeout(function(){var c=b.hiddenInput.val();b.cellFocus();var d=b.getEditor();d&&d.inputObjFocus(c,a);b.hiddenInput.val("")},10)},setValue:function(a,b,c){Slw.Utils.isUndefined(b)&&(b=this.curRow,c=this.curCol);this.setData(b,c,this.zHistory,a)},setCellData:function(){this.isFocus&&this.setData(this.curRow,this.curCol,this.zHistory)},setData:function(a,b,c,d){var e=!1;Slw.Utils.isUndefined(d)||(e=!0,this.hideEditor());this.curRow=a;this.curCol=b;var f=this.getCurConfig();if(f&&f.editor.editable){e?f.editor.inputObjFocus(d,!1):d=f.editor.getInputValue();var g=this.getDataIndex(),h=this.curArray.getData(g,f.name);d!=h&&(c.setHistory("upd",a,b,h),this.curArray.setData(g,f.name,d),c=f.editor.getHtml(g),this.setTdValue(a,b,c),this.isColIndex()&&this.checkChanged(g),this.afterEdit(a,b,d),e||this.yHistory.clear());e?this.moveBorder():f.editor.hide()}},hideEditor:function(){this.isFocus=!1;var a=this.getEditor();null!=a&&a.editable&&a.hide()},moveBorder:function(a,b){this.editable&&(this.hideEditor(),this.selection.hide(),Slw.Utils.isUndefined(a)||(this.curRow=a,this.curCol=b),this.selection.selRow=this.curRow,this.selection.selCol=this.curCol,this.setPosition(a,b),this.selection.cellBorder.show(this.borderPos),this.hiddenInputMoveTo())},hiddenInputMoveTo:function(a){var b=this.pos.left,c=this.pos.top;Slw.Utils.isUndefined(a)||(b=a.position().left,c=a.position().top);if(!this.debug){try{var d=this.table.parents(this.option.scrollDiv),e=d.scrollTop(),f=d.height()-this.option.scrollOffsetBottom;0<c-(f+e)?d.scrollTop(c-f):c+this.option.scrollOffsetTop<e&&d.scrollTop(c+this.option.scrollOffsetTop);var g=d.scrollLeft(),h=d.width()-10;0<b-(h+g)?d.scrollLeft(b-h):b+this.option.scrollOffsetTop<g&&d.scrollTop(b+10)}catch(k){}this.hiddenInput.css({left:b+"px",top:c+"px"})}this.defaultFocus(2)},setPosition:function(a,b){Slw.Utils.isUndefined(a)||(this.curRow=a,this.curCol=b);var c=this.trs.eq(this.curRow).find("td").eq(this.curCol);this.borderPos.left=c.position().left;this.borderPos.top=c.position().top;this.borderPos.width=c.outerWidth();this.borderPos.height=c.outerHeight();this.pos.left=this.borderPos.left+2;this.pos.top=this.borderPos.top+2;this.pos.width=this.borderPos.width-2;this.pos.height=this.borderPos.height-2;Slw.Utils.isIE()&&7==Slw.Utils.ieVersion()&&(this.pos.width=this.borderPos.width-14,this.pos.height=this.borderPos.height-10)},cellFocus:function(a){this.isFocus=!0;var b=this.getCurConfig();if(b&&b.editor.editable){this.moveTo(b.editor.inputObj);b.editor.inputObj.css("text-align",b.alignArray[0]);var c=this.getDataIndex();b.editor.show(c);a&&b.editor.keyEvent()}},getTd:function(a,b){return a.find("td").eq(b)},getTdByRow:function(a,b){return this.getTd(this.trs.eq(a),b)},getTdByIndex:function(a,b){return this.isColIndex()?this.getTdByRow(a,b.index):this.getTdByRow(b.index,a+this.option.indexStart)},getTdValue:function(a,b){return this.getTd(a,b).html()},setTdValue:function(a,b,c){var d=this.getTdByRow(a,b);d.html(c);this.validator.testCell(d,a,b)},getTdHtml:function(a,b){return this.getTdByRow(a,b).html()+""},setDataAndHtml:function(a,b,c){a.name&&(this.curArray.setData(b,a.name,c),this.setHtml(a,b))},setHtml:function(a,b){var c=a.editor.getHtml(b);this.isColIndex()?this.setTdValue(b,a.index,c):this.setTdValue(a.index,b+this.option.indexStart,c)},addOper:function(a,b){a[this.option.idName]=b+a[this.option.idName]},getRowId:function(a){return this.curArray.get(a).slwRowId},moveTo:function(a){a.css({left:this.pos.left+"px",top:this.pos.top+"px",width:this.pos.width+"px",height:this.pos.height+"px"})},defaultFocus:function(a){var b=this;setTimeout(function(){b.hiddenInput.focus()},50)},toDataArray:function(a){for(var b=[],c=0;c<a.length;c++){var d=this.toDataArraySub(a[c]);b.push(d)}return b},toDataArraySub:function(a){var b=[],c;for(c in this.editCols){var d=this.cfgHelper.getConfig(c);d&&d.name&&b.push(a[d.name])}return b},getDataArray:function(){var a=this.getData();return this.toDataArray(a)},getEditDataArray:function(){var a=this.getEditData();return this.toDataArray(a)},returnJson:function(a,b){a||(a={});a[this.option.paramName]=JSON.stringify(b);return a},getData:function(){return this.option.autoAddRow?this.curArray.getArray(0,this.curArray.size()-1):this.curArray.data},getEditData:function(){for(var a=[],b=this.getDataRows(),c=0;c<b;c++){var d=this.curArray.get(c);this.rowChanged(c)&&(d=$.extend(!0,{},d),""!=d[this.option.idName]&&this.addOper(d,"u"),a.push(d))}for(var e in this.delData)b=$.extend(!0,{},this.delData[e]),this.addOper(b,"d"),a.push(b);return a},getDataJson:function(a){var b=this.getData();return this.returnJson(a,b)},getEditDataJson:function(a){return this.returnJson(a,this.getEditData())},validate:function(){return this.validator.check()},smallSize:function(){this.resizer.smallSize()},fitSize:function(){this.resizer.fitSize()},autoFit:function(){this.resizer.autoFit()},setWidth:function(a,b){var c=this.table.find("thead tr"),c=c.eq(c.length-1);this.resizer.setWidth(c.find("th").eq(a),b)},getAlignArray:function(){var a=Array(2);a[0]=[];a[1]=[];for(var b=0;b<this.cols;b++){var c=this.getAlign(b);a[0].push(c[0]);a[1].push(c[1])}return a},getAlign:function(a){return this.cfgHelper.getConfig(a).alignArray},printData:function(){console.log(this.preRow+","+this.preCol+","+this.curRow+","+this.curCol);console.log(this.srcArray.data);console.log(this.curArray.data)}}})(jQuery);(function(){SlwGrid.Text=function(a,b){this.grid=a;this.config=b;this.inputObj;this.editable=!0;this.render=null};SlwGrid.Text.prototype={init:function(){var a=this.grid;this.inputObj="textarea"==this.config.type?a.textarea:a.textInput;this.config.render&&"string"===typeof this.config.render&&(this.render=Slw.template(this.config.render))},inputObjFocus:function(a,b){b&&this.inputObj.focus();this.inputObj.val(a)},getInputValue:function(){return this.inputObj.val()},getHtml:function(a){var b=this.grid.curArray.get(a);this.checkData(b);return this.getHtmlByData(b,a)},checkData:function(a){},getHtmlByData:function(a,b){var c=a[this.config.name];null!=this.render?c=this.render(a,b):$.isFunction(this.config.render)&&(c=this.config.render.apply(this.grid,[b,this.config.index,a,this.config]));return Slw.Utils.toHtml(c)},getCellData:function(a,b){return Slw.Utils.toText(this.grid.getTdValue(a,b))},show:function(a){a=this.grid.curArray.get(a)[this.config.name];this.inputObj.val(a);this.inputObj.show();this.initFormat()},hide:function(){this.endFormat();this.inputObj.hide()},keyEvent:function(){this.inputObj.focus();var a=this.inputObj[0],b=a.value.length;document.selection?(a=a.createTextRange(),a.moveStart("character",b),a.collapse(),a.select()):"number"==typeof a.selectionStart&&"number"==typeof a.selectionEnd&&(a.selectionStart=a.selectionEnd=b);setTimeout(function(){this.inputObj.focus()},50)},initFormat:function(){var a=this.config.options;if(a){if(a.input&&"char"!=a.input)this.inputObj.on("keyup blur",function(b){37!=b.keyCode&&(this.value=this.value.replace(Slw.Input[a.input],""))});a.maxlength&&this.inputObj.attr("maxlength",a.maxlength)}},endFormat:function(){this.inputObj.removeAttr("maxlength");var a=this.config.options;a&&a.input&&this.inputObj.unbind("keyup blur")}}})(jQuery);(function(){SlwGrid.Read=function(a,b){this.grid=a;this.config=b;this.editable=!1;this.valueRender=this.render=null};SlwGrid.Read.prototype={init:function(){this.config.render&&"string"===typeof this.config.render&&(this.render=Slw.template(this.config.render));this.config.valueRender&&"string"===typeof this.config.valueRender&&(this.valueRender=Slw.template(this.config.valueRender))},getCellData:function(a,b){return Slw.Utils.toText(this.grid.getTdValue(a,b))},getHtml:function(a){var b=this.grid.curArray.get(a);return this.getHtmlByData(b,a)},getHtmlByData:function(a,b){var c=a[this.config.name];null!=this.render?c=this.render(a,b):$.isFunction(this.config.render)&&(c=this.config.render.apply(this.grid,[b,this.config.index,a,this.config]));return Slw.Utils.toHtml(c)},setValueByRender:function(a,b){var c;null!=this.valueRender?c=this.valueRender(a,b):$.isFunction(this.config.valueRender)&&(c=this.config.valueRender.apply(this.grid,[b,this.config.index,a,this.config]));a[this.config.name]=c},hide:function(){}}})(jQuery);(function(){SlwGrid.Dict=function(a,b){this.grid=a;this.config=b;this.editable=!0;this.defaults={data:"dictParent@dictTable",cssStyle:a.gridClass,ajaxDataType:"dict",autoHeight:!1,hideFlag:!0,onClose:function(){a.defaultFocus()}};this.options=$.extend(this.defaults,b.options);this.select=null;this.inputObj=a.textInput};SlwGrid.Dict.prototype={init:function(){this.select=this.inputObj.jqSelect(this.options);this.select.hide()},inputObjFocus:function(a,b){if(""==a)this.inputObj.val(""),this.select.setLabel("");else{var c=this.getItemByKey(a);c&&(this.inputObj.val(a),this.select.setLabel(c[this.config.format]))}b&&this.grid.defaultFocus()},getInputValue:function(){var a=this.getItemByKey(this.inputObj.val());return a?a.code:""},getHtml:function(a){var b=this.grid.curArray.get(a);return this.getHtmlByData(b,a)},getHtmlByData:function(a,b){var c=this.getItemByKey(a[this.config.name]),d="";Slw.Utils.isUndefined(c)?a[this.config.name]="":d=c[this.config.format];return d},getCellData:function(a,b){var c=this.getItem(this.grid.getTdValue(a,b));return c?c.code:""},getItemByKey:function(a){return Slw.Dict.getDictItem(this.options.data,a)},getItem:function(a){var b=Slw.Dict.getDictList(this.options.data),c;for(c in b){var d=b[c];if(a==d[this.config.format])return d}},show:function(a){var b=this.grid;a=b.curArray.get(a)[this.config.name];a=this.getItemByKey(a);Slw.Utils.isUndefined(a)?(this.inputObj.val(""),this.select.setLabel("")):(this.inputObj.val(a.code),this.select.setLabel(a[this.config.format]));this.select.inputView.css("text-align",this.config.txtAlign);this.select.show(b.pos)},hide:function(){this.select.hide()},keyEvent:function(){this.select.selectObj.initShow();this.inputObj.focus()}}})(jQuery);(function(){SlwGrid.Checkbox=function(a,b){this.grid=a;this.config=b;this.editable=!0;this.inputObj=a.textInput};SlwGrid.Checkbox.prototype=new SlwGrid.Text;$.extend(SlwGrid.Checkbox.prototype,{init:function(a){var b=this;b.config.render=function(a,d,e){return e[b.config.name]==b.config.options.values[0]?'\x3ci class\x3d"fa fa-check-square-o"\x3e\x3c/i\x3e':'\x3ci class\x3d"fa fa-square-o"\x3e\x3c/i\x3e'}},nextValue:function(a){var b;for(b=0;2>b&&a!=this.config.options.values[b];b++);b=1<b?this.config.options.defaultIndex:b;return this.config.options.values[1-b]},show:function(a){var b=this.grid;a=b.curArray.getData(a,this.config.name);a=this.nextValue(a);b.setValue(a)}})})(jQuery);(function(){SlwGrid.Date=function(a,b){this.grid=a;this.config=b;this.editable=!0;this.options=$.extend(this.defaults,b.options);this.inputObj=$('\x3cinput class\x3d"'+a.gridClass+' Wdate" style\x3d"background-color:#fff"\x3e\x3c/input\x3e')};SlwGrid.Date.prototype=new SlwGrid.Text;$.extend(SlwGrid.Date.prototype,{init:function(){var a=this,b=this.grid;b.table.after(a.inputObj);a.options.el=a.inputObj[0];a.options.onpicking=function(a){b.defaultFocus()};a.inputObj.focus(function(){WdatePicker(a.options)});a.inputObj.keydown(function(a){a.stopPropagation();switch(a.keyCode){case 13:a.preventDefault(),b.defaultFocus()}})},show:function(a){var b=this.grid;a=b.curArray.get(a)[this.config.name];this.inputObj.val(a);this.inputObj.show();b.defaultFocus()},hide:function(){this.inputObj.hide();$dp.hide()},keyEvent:function(){var a=this;a.inputObj.focus();$dp.show();setTimeout(function(){a.inputObj.focus()},50)}})})(jQuery);(function(){SlwGrid.Tree=function(a,b){this.grid=a;this.config=b;this.editable=!0;this.inputObj=a.textInput;this.tree};SlwGrid.Tree.prototype={init:function(){var a=this.grid,b=this;this.defaults={loadUrl:"",cssStyle:"",curNodeId:"",height:200,width:0,hideFlag:!0,onLoad:function(){a.refreshColumnCell(b.config)}};this.options=$.extend(this.defaults,this.config.options);this.tree=this.inputObj.slwTree(this.options);this.tree.hide()},inputObjFocus:function(a,b){if(""==a)this.tree.setValue(""),this.tree.setLabel("");else{var c=this.tree.getNode(a);c&&(this.tree.setValue(c.value),this.tree.setLabel(c.name))}b&&this.grid.defaultFocus()},getInputValue:function(){var a=this.tree.getNode(this.inputObj.val());return a?a.value:""},getHtml:function(a){var b=this.grid.curArray.get(a);return this.getHtmlByData(b,a)},getHtmlByData:function(a,b){var c=this.tree.getNode(a[this.config.name]),d="";c&&(d=c.name);return d},getCellData:function(a,b){var c=this.grid.getTdValue(a,b);return(c=this.tree.find("name",c))?c.name:""},show:function(a){var b=this.grid;a=b.curArray.get(a)[this.config.name];(a=this.tree.getNode(a))?(this.tree.setValue(a.value),this.tree.setLabel(a.name)):(this.tree.setValue(""),this.tree.setLabel(""));this.tree.inputView.css("text-align",this.config.txtAlign);this.tree.show(b.pos);b.defaultFocus()},hide:function(){this.tree.hide()},keyEvent:function(){}}})(jQuery);(function(){SlwGrid.Color=function(a,b){this.grid=a;this.config=b;this.editable=!0;this.inputObj=$('\x3cinput class\x3d"'+a.gridClass+'"\x3e\x3c/input\x3e');this.color=null;this.defaults={bgColor:!0,documentClick:!1,cssStyle:"",onClose:function(){a.defaultFocus()}};this.options=$.extend(this.defaults,b.options)};SlwGrid.Color.prototype=new SlwGrid.Text;$.extend(SlwGrid.Color.prototype,{init:function(){this.grid.table.after(this.inputObj);this.config.render&&"string"===typeof this.config.render&&(this.render=Slw.template(this.config.render));this.color=this.inputObj.slwColor(this.options)},checkData:function(a){var b=this.color.testColor(a[this.config.name]);a[this.config.name]=b},show:function(a){a=this.grid.curArray.get(a)[this.config.name];this.inputObj.val(a);this.inputObj.show();this.color.focus(this.inputObj)},hide:function(){this.inputObj.hide();this.inputObj.css("background-color","#FFFFFF");this.color.hide()},keyEvent:function(a){}})})(jQuery);(function(){SlwGrid.Other=function(a,b){this.grid=a;this.config=b;this.editable=!0;this.inputObj=a.textInput;this.valueRender=this.render=null};SlwGrid.Other.prototype=new SlwGrid.Text;SlwGrid.Other.prototype.show=function(a){var b=this.grid,c=b.curArray.get(a);$.isFunction(this.config.userShow)&&(b.isFocus=!1,$SlwGrid.grid=b,this.config.userShow.apply(b,[a,this.config.index,c,this.config]))}})(jQuery);(function(){SlwGrid.CtxMenu=function(a){this.grid=a;this.oper="";this.fromRow;this.toRow;this.operData=null};SlwGrid.CtxMenu.prototype={init:function(){var a;a='\x3cul class\x3d"dropdown-menu" id\x3d"slwGridMenu"\x3e'.concat('\x3cli rel\x3d"copy"\x3e\x3ca href\x3d"javascript:;"\x3e\u590d\u5236\x3c/a\x3e\x3c/li\x3e');a=a.concat('\x3cli rel\x3d"cut"\x3e\x3ca href\x3d"javascript:;"\x3e\u526a\u5207\x3c/a\x3e\x3c/li\x3e');a=a.concat('\x3cli rel\x3d"paste"\x3e\x3ca href\x3d"javascript:;"\x3e\u7c98\u8d34\x3c/a\x3e\x3c/li\x3e');a=a.concat('\x3cli rel\x3d"del"\x3e\x3ca href\x3d"javascript:;"\x3e\u5220\u9664\x3c/a\x3e\x3c/li\x3e');a=a.concat("\x3c/ul\x3e");this.grid.table.after(a)},showMenu:function(a){var b=this,c=this.grid;a.contextMenu("slwGridMenu",{init:function(a,e){b.fromRow=c.curRow;b.toRow=c.selection.selRow;if(!(0>b.toRow)){e.find("[rel\x3dpaste]").css("display",""==b.oper?"none":"");var d;if(b.fromRow!=b.toRow)e.find("[rel\x3dpaste]").css("display",""==b.oper?"none":""),d="\u7b2c"+(b.fromRow+1)+"~"+(b.toRow+1)+"\u884c\u6570\u636e";else if(d="\u7b2c"+(b.fromRow+1)+"\u884c\u6570\u636e",""!=b.oper){var g="copy"==b.oper?"\u7c98\u8d34":"\u526a\u5207";e.find("[rel\x3dpaste] a").html(g+" \u6570\u636e\u5230\u7b2c "+(b.fromRow+1)+"\u884c\u524d")}e.find("[rel\x3dcopy] a").html("\u590d\u5236 "+d);e.find("[rel\x3dcut] a").html("\u526a\u5207 "+d);e.find("[rel\x3ddel] a").html("\u5220\u9664 "+d)}},callback:{del:function(a){c.delRows(b.fromRow,b.toRow,c.zHistory);c.resetBeforeEl()},copy:function(a){b.oper="copy";b.operData=c.copyRows(b.fromRow,b.toRow)},cut:function(a){b.oper="cut";b.operData={};b.operData.fromRow=b.fromRow;b.operData.toRow=b.toRow},paste:function(a){if("copy"==b.oper){if(null==b.operData)return;a=[[],[]];for(var d=0;d<b.operData.length;d++){var f=c.initNewData(),g=$.extend(!0,{},b.operData[d]);c.copyUuid(f,g);Slw.Utils.isEqual(f,g)||(a[0].push(f),a[1].push(g))}d={};d.row=b.toRow;d.data=a;c.addRows(d,c.zHistory)}else{if(b.toRow>=b.operData.fromRow&&b.toRow<=b.operData.toRow)return;d={};d.row=b.toRow;d.data={};d.data.fromRow=b.operData.fromRow;d.data.num=b.operData.toRow-b.operData.fromRow+1;c.cutRows(d,c.zHistory);b.oper=""}c.resetBeforeEl()}}})}}})(jQuery);(function(){SlwGrid.History=function(a){this.grid=a;this.hisObject=null;this.ctrlMap=[]};SlwGrid.History.prototype={setHistory:function(a,b,c,d){var e={};e.oper=a;e.row=b;e.col=c;e.data=d;this.ctrlMap.push(e)},history:function(){var a=this.ctrlMap.pop();a&&(this.grid.hideEditor(),this.grid.selection.hideAll(),"upd"==a.oper?this.updRollback(a):"cut"==a.oper?this.cutRollback(a):"del"==a.oper?this.delRollback(a):"paste"==a.oper?this.pasteRollback(a):"add"==a.oper&&this.addRollback(a))},pasteRollback:function(a){this.grid.clipboard.setSelData(a.row,a.col,a.data,this.hisObject)},updRollback:function(a){this.grid.setData(a.row,a.col,this.hisObject,a.data)},cutRollback:function(a){this.grid.cutRows(a,this.hisObject)},delRollback:function(a){this.grid.addRows(a,this.hisObject)},addRollback:function(a){this.grid.delRows(a.row,a.row+a.data[0].length-1,this.hisObject)},clear:function(){this.ctrlMap.length=0}}})(jQuery);(function(){SlwGrid.Formula=function(a){this.grid=a;this.datas=[];this.cfg;this.rows=this.index=0;this.cache={}};SlwGrid.Formula.prototype={run:function(a){this.init(a);for(var b=0;b<a.formula.length;b++)this.index=b,this.initData(),""!=a.formula[b]&&this.parseFormula(a.formula[b])},init:function(a){this.cfg=a;this.result={max:null,min:null,sum:0,ok:!1};this.rows=this.grid.getDataRows()},getBasicResult:function(a){this.init(a);this.basicComputation();return this.result},percent:function(a,b){var c=this.cache[b];c||(c=this.grid.cfgHelper.getConfigByName(b),c=this.getBasicResult(c),this.cache[b]=c);if(c.sum&&0!=c.sum)for(var d=this.grid.getDataRows(),e=0;e<d;e++){var f=100*parseFloat(this.grid.curArray.getData(e,b))/c.sum;this.grid.setDataAndHtml(a,e,f)}},order:function(a,b,c){var d=this.grid;a.name in d.newRowExceptCol||(d.newRowExceptCol[a.name]=a.name);if(!c)for(c=this.grid.curArray.size();b<c;b++)this.grid.setDataAndHtml(a,b,b+1)},group:function(a,b,c){var d=this.grid,e=d.getTdHtml(b,a.index),f=a.editor.getHtml(b);if(!c||e!=f){d.setTdValue(b,a.index,f);b=null;c="";for(var e=1,g=d.getDataRows(),h=0;h<g;h++){var k=d.trs.eq(h).find("td").eq(a.index);k.css("display","");k.attr("rowspan",1);f=a.editor.getHtml(h);k.html(f);null==b||c!=k.html()?(1<e&&(b.attr("rowspan",e),b.addClass("text-middle")),b=k,c=f+"",e=1):(k.css("display","none"),e++)}1<e&&(b.attr("rowspan",e),b.addClass("text-middle"))}},render:function(){this.drawHtml()},sum:function(){this.basicComputation();this.setData(this.result.sum)},avg:function(a){Slw.Utils.isUndefined(a)&&(a=2);if(0<this.rows){this.basicComputation();var b=this.result.sum/this.rows,b=Slw.Format.toFixed(b,a);this.setData(b)}},max:function(){this.basicComputation();this.setData(this.result.max)},min:function(){this.basicComputation();this.setData(this.result.min)},parseFormula:function(a){var b=a,c,d=/\((.+?)\)/g.exec(a);null!=d&&(b=a.substring(0,d.index),c=d[1]);this[b](c)},initData:function(){this.datas.length==this.index&&this.datas.push({})},basicComputation:function(){if(1!=this.result.ok){for(var a=0;a<this.rows;a++){var b=parseFloat(this.grid.curArray.getData(a,this.cfg.name));this.result.sum+=b;this.result.max=null==this.result.max?b:Math.max(this.result.max,b);this.result.min=null==this.result.min?b:Math.min(this.result.min,b)}this.result.ok=!0;this.cfg.name in this.cache&&(this.cache[this.cfg.name]=this.result)}},setData:function(a){this.datas[this.index][this.cfg.name]=a;this.drawHtml()},getData:function(){return this.datas[this.index]},drawHtml:function(){try{var a=this.grid,b=this.cfg.editor.getHtmlByData(this.getData(),a.getDataRows()+this.index);(a.isColIndex()?a.getTFoot(this.index,this.cfg.index):a.getTdByRow(this.cfg.index,this.index+a.option.indexStart+a.getDataRows())).html(b)}catch(c){}}}})(jQuery);(function(){SlwGrid.Selection=function(a){this.grid=a;this.cellBorder;this.areaBorder;this.beforeEl;this.preArea={};this.selCol=this.selRow=-1};SlwGrid.Selection.prototype={init:function(){var a=this.grid;this.areaBorder=new SlwGrid.Border(a);this.cellBorder=new SlwGrid.Border(a);this.areaBorder.init();this.cellBorder.init({borderSize:2,borderClass:"slwGridSelCell"});this.beforeEl=this.areaBorder.borderDiv[0]},inSelectionArea:function(a,b){var c=this.getSelectionArea();return 0<=c.startRow&&a>=c.startRow&&a<=c.toRow&&b>=c.startCol&&b<=c.toCol},getSelectionArea:function(){var a={},b=this.grid;a.startRow=b.curRow;a.startCol=b.curCol;a.toRow=this.selRow;a.toCol=this.selCol;a.startRow>this.selRow&&(a.toRow=a.startRow,a.startRow=this.selRow);a.startCol>this.selCol&&(a.toCol=a.startCol,a.startCol=this.selCol);return a},beginDraw:function(a,b){var c=this.grid;this.selRow=a.parent().index();this.selCol=a.index();this.drawSelection();c.defaultFocus()},checkTwiceClick:function(){var a=this.grid;a.resetBeforeEl();this.selRow==a.preRow&&this.selCol==a.preCol&&a.cellFocus(!0)},shiftDraw:function(a,b){var c=this.grid;this.selRow=a;this.selCol=0==c.curCol&&c.curCol==b?c.cols-1:b;this.drawSelection();c.defaultFocus()},drawSelection:function(){this.preArea&&this.drawArea(this.preArea,!1);var a=this.getSelectionArea();this.preArea=a;this.drawBorder(a);this.drawArea(a,!0)},drawBorder:function(a){var b={},c=this.grid,d=c.trs.eq(a.startRow).find("td").eq(a.startCol);a=c.trs.eq(a.toRow).find("td").eq(a.toCol);b.left=d.position().left;b.top=d.position().top;b.width=a.position().left-b.left+a.outerWidth();b.height=a.position().top-b.top+a.outerHeight();this.areaBorder.show(b)},drawArea:function(a,b){for(var c=this.grid,d=a.startCol;d<a.toCol+1;d++)for(var e=a.startRow;e<a.toRow+1;e++){var f=c.getTdByRow(e,d);b?f.addClass("area"):f.removeClass("area")}},hide:function(){var a=this.getSelectionArea();this.drawArea(a,!1);this.selCol=this.selRow=-1;this.areaBorder.hide()},hideAll:function(){this.hide();this.cellBorder.hide()}}})(jQuery);(function(){SlwGrid.Border=function(a){this.grid=a;this.defaults={borderSize:1,borderClass:"slwGridSelArea"}};SlwGrid.Border.prototype={init:function(a){var b=this.grid;this.options=$.extend(this.defaults,a);this.borderDiv=$('\x3cdiv class\x3d"'+this.options.borderClass+'"\x3e\x3c/div\x3e');this.beforeEl=this.borderDiv[0];this.lBorder=$('\x3cdiv style\x3d"width: '+this.options.borderSize+'px; top: 0px; left: 0px"\x3e\x3c/div\x3e');this.rBorder=$('\x3cdiv style\x3d"width: '+this.options.borderSize+'px; top: 0px;"\x3e\x3c/div\x3e');this.tBorder=$('\x3cdiv style\x3d"height:'+this.options.borderSize+'px; top: 0px; left: 0px;"\x3e\x3c/div\x3e');this.bBorder=$('\x3cdiv style\x3d"height:'+this.options.borderSize+'px; left: 0px;"\x3e\x3c/div\x3e');this.borderDiv.append(this.lBorder);this.borderDiv.append(this.rBorder);this.borderDiv.append(this.tBorder);this.borderDiv.append(this.bBorder);b.table.after(this.borderDiv)},show:function(a){this.borderDiv.css({left:a.left+"px",top:a.top+"px",width:"0px",height:"0px"});this.lBorder.css({height:a.height+"px"});this.rBorder.css({left:a.width+"px",height:a.height+1+"px"});this.tBorder.css({width:a.width+"px"});this.bBorder.css({top:a.height+"px",width:a.width+1+"px"});this.borderDiv.show()},hide:function(){this.borderDiv.hide()}}})(jQuery);(function(){SlwGrid.Keyboard=function(a){this.grid=a;this.isInputZh=!1};SlwGrid.Keyboard.prototype={inputEvent:function(){var a=this,b=this.grid;b.hiddenInput.on("compositionstart",function(c){b.pressCtrl||(a.isInputZh=!0)});b.hiddenInput.on("compositionend",function(c){b.pressCtrl||(a.isInputZh=!1,b.textObjectFocus(!0))});b.hiddenInput.on("input",function(c){b.pressCtrl||a.isInputZh||b.textObjectFocus(!0)});b.hiddenInput.on("keydown",function(c){if(!a.moveEvent(c,null))switch(c.keyCode){case 27:c.preventDefault();b.hideEditor();b.defaultFocus();break;case 46:b.clipboard.delData();break;case 16:b.pressShift=!0;break;case 17:b.pressCtrl=!0;break;case 13:c.preventDefault();b.cellFocus();b.getEditor().keyEvent(c.keyCode);break;default:Slw.Utils.isIE()&&9>Slw.Utils.ieVersion()&&!b.pressCtrl&&b.textObjectFocus(!0)}});b.hiddenInput.on("keyup",function(a){switch(a.keyCode){case 16:b.pressShift=!1;break;case 17:b.pressCtrl=!1;break;case 67:b.clipboard.copyData();break;case 86:b.clipboard.pasteData();break;case 89:b.pressCtrl&&(a.preventDefault(),b.yHistory.history());break;case 90:b.pressCtrl&&(a.preventDefault(),b.zHistory.history())}})},moveEvent:function(a,b){var c=this.grid;a.stopPropagation();if(!c.editable)return!0;var d=!0,e=!1;switch(a.keyCode){case 37:c.selection.hide();e=this.prevCol(b);break;case 39:c.selection.hide();e=this.nextCol(b);break;case 38:c.selection.hide();e=this.prevRow(b);break;case 40:c.selection.hide();e=this.nextRow(b);break;default:d=!1}c.removeFlag=!1;e&&c.moveBorder();return d},checkNext:function(a){return null==a||a.selectionStart==a.selectionEnd&&a.selectionStart==a.value.length},checkPrev:function(a){return null==a||a.selectionStart==a.selectionEnd&&0==a.selectionStart},nextRow:function(a){a=this.grid;a.setCellData();a.isColIndex()?a.curRow=(a.curRow+1)%a.rows:this.nextRowSub();return!0},prevRow:function(a){a=this.grid;a.setCellData();a.isColIndex()?(a.removeFlag&&1<a.rows&&a.curRow++,a.curRow=(a.rows+a.curRow-1)%a.rows):this.prevRowSub();return!0},nextCol:function(a){var b=this.grid,c=!0;if(b.isColIndex()){if(c=this.checkNext(a))b.setCellData(),this.nextColSub()}else b.setCellData(),b.curCol=(b.curCol+1)%b.cols,0==b.curCol&&(b.curCol=b.option.indexStart,this.nextRow());return c},prevCol:function(a){var b=this.grid,c=!0;if(b.isColIndex()){if(c=this.checkPrev(a))b.setCellData(),this.prevColSub()}else b.setCellData(),b.curCol=(b.cols+b.curCol-1)%b.cols,b.curCol<b.option.indexStart&&(b.curCol=b.cols-1,this.prevRow());return c},nextColSub:function(){var a=this.grid;a.curCol+=1;a.curCol>=a.cols&&(this.nextRow(),a.curCol=0);for(;!a.cfgHelper.isEditable(a.curCol);)this.nextColSub()},prevColSub:function(){var a=this.grid;--a.curCol;0>a.curCol&&(this.prevRow(),a.curCol=a.cols-1);for(;!a.cfgHelper.isEditable(a.curCol);)this.prevColSub()},nextRowSub:function(){var a=this.grid;for(a.curRow=(a.curRow+1)%a.rows;!a.cfgHelper.isEditable(a.curRow);)this.nextRowSub()},prevRowSub:function(){var a=this.grid;for(a.curRow=(a.rows+a.curRow-1)%a.rows;!a.cfgHelper.isEditable(a.curRow);)this.prevRowSub()}}})(jQuery);(function(){SlwGrid.Clipboard=function(a){this.grid=a;this.cbTextarea=$('\x3ctextarea class\x3d"slwGridHiddenInput"\x3e\x3c/textarea\x3e');this.gridMenu};SlwGrid.Clipboard.prototype={init:function(){this.grid.table.after(this.cbTextarea)},setSelData:function(a,b,c,d){var e=this.grid;e.hideEditor();var f=e.getDataRows();if(e.option.autoAddRow)for(var g=0;g<a+c.length-f;g++)e.createNewRow(!1);f=[];for(g=0;g<c.length;g++)f[g]=[];for(var h=0,k=b;k<e.cols;k++){for(g=0;g<c.length;g++){var l=e.getCurConfig(g+a,k),m=e.getDataIndex(g+a,k);f[g][h]=e.curArray.getData(m,l.name);l&&"read"!=l.type&&e.setDataAndHtml(l,m,c[g][h])}h++;if(h>=c[0].length)break}e.refreshAll(a);e.removeEmptyFromRow(a);d.setHistory("paste",a,b,f);e.moveBorder()},pasteData:function(){var a=this.grid,b=this.grid.hiddenInput.val();a.hiddenInput.val("");for(var c=[],b=b.split("\n"),d=0;d<b.length;d++)if(""!=b[d].trim()){var e=b[d].split("\t");c.push(e)}this.setSelData(a.curRow,a.curCol,c,a.zHistory)},delData:function(){var a=this.grid;if(!(0>a.selection.selRow)){for(var b=a.selection.getSelectionArea(),c=Array(b.toRow-b.startRow+1),d=0;d<c.length;d++)c[d]=Array(b.toCol-b.startCol+1);for(d=0;d<c.length;d++)for(var e=0;e<c[0].length;e++)c[d][e]="";this.setSelData(b.startRow,b.startCol,c,a.zHistory)}},copyData:function(){var a=this.grid;if(!(0>a.selection.selRow)){for(var b=a.selection.getSelectionArea(),c=Array(b.toRow-b.startRow+1),d=0;d<c.length;d++)c[d]=Array(b.toCol-b.startCol+1);for(var e=b.startCol;e<b.toCol+1;e++)for(d=b.startRow;d<b.toRow+1;d++){var f=a.getCurConfig(d,e),f=f&&f.name?a.curArray.getData(a.getDataIndex(d,e),f.name):a.getTdHtml(d,e);c[d-b.startRow][e-b.startCol]=f}a="";for(d=0;d<c.length;d++)a+=c[d].join("\t"),d<c.length-1&&(a+="\n");this.copyValue(a)}},copyValue:function(a){this.cbTextarea.val(a);this.cbTextarea[0].select();document.execCommand("Copy");this.grid.hiddenInput.focus()}}})(jQuery);(function(){SlwGrid.Data=function(){this.data=[]};SlwGrid.Data.prototype={getData:function(a,b){return this.data[a][b]},setData:function(a,b,c){this.data[a][b]=c},size:function(){return this.data.length},get:function(a){return this.data[a]},clone:function(a){return $.extend(!0,{},this.get(a))},getArray:function(a,b){b=Slw.Utils.isUndefined(b)?a+1:b+1;return this.data.slice(a,b)},cloneArray:function(a,b){return $.extend(!0,[],this.getArray(a,b))},cloneAll:function(){return $.extend(!0,[],this.data)},add:function(a,b){for(var c=0;c<b.length;c++)this.data.splice(a+c,0,b[c])},remove:function(a,b){return this.data.splice(a,b)}}})(jQuery);(function(){SlwGrid.Config=function(a){this.grid=a;this.type={text:{className:SlwGrid.Text,config:{options:{input:"char",maxlength:20},defaultValue:"",tdClass:"text-center"}},textarea:{className:SlwGrid.Text,config:{options:{input:"char",maxlength:100},defaultValue:"",tdClass:"text-left"}},dict:{className:SlwGrid.Dict,config:{options:{data:"dictParent@dictTable",selectInputQuery:!1},format:"name",defaultValue:"",tdClass:"text-center"}},checkbox:{className:SlwGrid.Checkbox,config:{options:{values:["1","2"]},defaultValue:"2",tdClass:"text-center"}},tree:{className:SlwGrid.Tree,config:{options:{loadUrl:""},defaultValue:"",tdClass:"text-center"}},date:{className:SlwGrid.Date,config:{options:{dateFmt:"yyyy-MM-dd",readOnly:!0},defaultValue:"",tdClass:"text-center"}},read:{className:SlwGrid.Read,config:{defaultValue:"",tdClass:"tdRead text-center"}},order:{className:SlwGrid.Read,config:{valueRender:function(a,c,d){this.formula.order(a,c,d)},refresh:"column",render:"\x3cslw%\x3d(index+1)%slw\x3e",defaultValue:"",tdClass:"tdRead text-center"}},group:{className:SlwGrid.Read,config:{valueRender:function(a,c,d){return this.formula.group(a,c,d)},refresh:"column",defaultValue:"",tdClass:"tdRead text-center"}},other:{className:SlwGrid.Other,config:{userShow:function(a,c,d){},defaultValue:"",tdClass:"tdRead text-center"}},color:{className:SlwGrid.Color,config:{defaultValue:"#000000",tdClass:"text-center",options:{bgColor:!0,cssStyle:"",lang:1},validator:{required:!1,test:"color"}}}};this.dictMap={};this.dictArray=[];this.configs={}};SlwGrid.Config.prototype={getConfig:function(a){return this.configs[a]},getConfigByName:function(a){var b,c;for(c in this.configs)if(this.configs[c].name==a){b=this.configs[c];break}return b},isEditable:function(a){a=this.getConfig(a);return Slw.Utils.isUndefined(a)?!1:a.editor.editable},getOptions:function(a){return this.type[a].config},init:function(a){for(var b=this.grid,c=0;c<a.length;c++){var d=a[c];d.index||(d.index=c);this.initOptions(d)}for(c=0;c<b.option.dictArray.length;c++)a=b.option.dictArray[c],a in this.dictMap||(this.dictMap[a]=a,this.dictArray.push(a))},initOptions:function(a){var b=this.grid,c=this.getOptions(a.type),c=$.extend(!0,{},c);a.options=$.extend(c.options,a.options);a=$.extend(c,a);a.alignArray=["center","middle"];this.initTxtAlign(a);a.editor=this.initEditor(b,a);"dict"!=a.type||a.options.data in this.dictMap||(this.dictMap[a.options.data]=a.options.data,this.dictArray.push(a.options.data));this.configs[a.index]=a},initTxtAlign:function(a){a.tdClass&&(0<=a.tdClass.indexOf("text-left")?a.alignArray[0]="left":0<=a.tdClass.indexOf("text-right")?a.alignArray[0]="right":a.alignArray[0]="center",0<=a.tdClass.indexOf("text-top")?a.alignArray[1]="top":0<=a.tdClass.indexOf("text-bottom")?a.alignArray[1]="bottom":a.alignArray[1]="middle")},initEditor:function(a,b){var c=new this.type[b.type].className(a,b);c.init();return c}}})(jQuery);(function(){SlwGrid.Resizer=function(a){this.grid=a;this.guide=$('\x3cdiv class\x3d"slwGridcolumnResizerGuide"\x3e\x3c/div\x3e');this.resizer=$('\x3cdiv class\x3d"slwGridcolumnResizer"\x3e\x3c/div\x3e');this.size=6;this.dragFlag=!1;this.preLeft=0;this.curTh=null};SlwGrid.Resizer.prototype={init:function(a){a=this.grid;a.option.columnResize&&(a.table.css({width:"auto"}),a.table.after(this.guide),a.table.after(this.resizer),this.initEvent(),this.initMenu())},initEvent:function(){var a=this;this.grid.table.find("thead tr th").on("mousemove",function(b){if(!a.dragFlag){var c=$(this);c.outerWidth()-(b.clientX-c.offset().left)<a.size?(b={},b.left=c.offset().left+c.outerWidth()-a.size,b.top=c.offset().top,b.height=c.outerHeight(),a.curTh=c,a.show(b)):a.hide()}});a.resizer.on("mousedown.slwGridResize",function(b){a.dragFlag=!0;b.preventDefault();a.preLeft=a.guide.position().left;a.startEvent()})},startEvent:function(){var a=this;$(document).on("mousemove.slwGridResize",function(b){b.preventDefault();a.move(b.clientX)});$(document).on("mouseup.slwGridResize",function(b){b.preventDefault();a.resize();a.stopEvent()})},stopEvent:function(){$(document).unbind("mousemove.slwGridResize mouseup.slwGridResize")},move:function(a){this.guide.css({left:a-2+this.size-1+"px"});this.resizer.css({left:a-2+"px"})},resize:function(){var a=Math.round(this.curTh.outerWidth()+this.guide.position().left-this.preLeft);this.setWidth(this.curTh,a)},show:function(a){var b=this.grid;this.guide.css({left:a.left+this.size-1+"px",top:a.top+"px",height:b.table.height()-(this.curTh.offset().top-b.table.offset().top)+"px"});this.resizer.css({left:a.left+"px",top:a.top+"px",height:a.height+"px"});this.guide.show();this.resizer.show()},hide:function(){this.guide.hide();this.resizer.hide()},hideAll:function(){this.dragFlag=!1;this.grid.selection.hideAll();this.hide()},initMenu:function(){var a=this.grid,b;b='\x3cul class\x3d"dropdown-menu" id\x3d"slwGridThMenu"\x3e'.concat('\x3cli rel\x3d"left"\x3e\x3ca href\x3d"javascript:;"\x3e\u5c45\u5de6(Left)\x3c/a\x3e\x3c/li\x3e');b=b.concat('\x3cli rel\x3d"center"\x3e\x3ca href\x3d"javascript:;"\x3e\u5c45\u4e2d(Center)\x3c/a\x3e\x3c/li\x3e');b=b.concat('\x3cli rel\x3d"right"\x3e\x3ca href\x3d"javascript:;"\x3e\u5c45\u53f3(Right)\x3c/a\x3e\x3c/li\x3e');b=b.concat('\x3cli class\x3d"divider"\x3e\x3c/li\x3e');b=b.concat('\x3cli rel\x3d"top"\x3e\x3ca href\x3d"javascript:;"\x3e\u4e0a\u5bf9\u9f50(Top)\x3c/a\x3e\x3c/li\x3e');b=b.concat('\x3cli rel\x3d"middle"\x3e\x3ca href\x3d"javascript:;"\x3e\u4e2d\u5bf9\u9f50(Middle)\x3c/a\x3e\x3c/li\x3e');b=b.concat('\x3cli rel\x3d"bottom"\x3e\x3ca href\x3d"javascript:;"\x3e\u4e0b\u5bf9\u9f50(Bottom)\x3c/a\x3e\x3c/li\x3e');b=b.concat("\x3c/ul\x3e");a.table.after(b);this.showMenu(a.table.find("thead tr th"))},showMenu:function(a){var b=this,c=this.grid;a.each(function(){$(this).contextMenu("slwGridThMenu",{init:function(a,e){var d=a.index(),d=c.cfgHelper.getConfig(d);b.clearCheck(e);b.checkItem(d.alignArray[0],e);b.checkItem(d.alignArray[1],e)},callback:{left:function(a,c){b.setAlign(a,c,0)},center:function(a,c){b.setAlign(a,c,0)},right:function(a,c){b.setAlign(a,c,0)},top:function(a,c){b.setAlign(a,c,1)},middle:function(a,c){b.setAlign(a,c,1)},bottom:function(a,c){b.setAlign(a,c,1)}}})})},clearCheck:function(a){a.find("a").each(function(){$(this).html($(this).text())})},checkItem:function(a,b){var c;if(""!=a){c=b.find("[rel\x3d"+a+"] a");var d=c.text();c.html('\x3ci class\x3d"fa fa-check text-red"\x3e\x3c/i\x3e '+d)}},setAlign:function(a,b,c){var d=this.grid,e=a.index(),f=d.cfgHelper.getConfig(e);f.alignArray[c]=b;d.trs.each(function(){var a=$(this).find("td").eq(e);a.removeClass("text-left text-center text-right text-top text-middle text-bottom");a.addClass("text-"+f.alignArray[0]+" text-"+f.alignArray[1])})},smallSize:function(){var a=this.grid;a.table.css({width:"auto","max-width":"auto"});a.table.find("td, th").css({"white-space":"nowrap","text-overflow":"ellipsis","-o-text-overflow":"ellipsis"});a.table.find("thead tr th").each(function(){$(this).css("width","0px")});this.hide()},fitSize:function(){var a=this.grid;a.table.css({width:"100%","max-width":"100%"});a.table.find("td, th").css({"white-space":"","text-overflow":"","-o-text-overflow":""});a.table.find("thead tr th").each(function(){var a=$(this),c=a.attr("width");Slw.Utils.isUndefined(c)&&(c="0px");a.css("width",c)});this.hide()},autoFit:function(){var a=this.grid;a.table.css({width:"100%","max-width":"100%"});a.table.find("td, th").css({"white-space":"","text-overflow":"","-o-text-overflow":""});a.table.find("thead tr th").each(function(){$(this).css("width","0px")});this.hide()},setWidth:function(a,b){0<a.length&&b!=a.outerWidth()&&(a.css("width",b+"px"),this.hideAll(),$.isFunction(this.grid.option.afterColumnResize)&&this.grid.option.afterColumnResize.apply(this.grid,[a.index(),b]));this.hide()}}})(jQuery);(function(){SlwGrid.Validator=function(a){this.grid=a;this.beforeEl=a.hiddenInput[0];this.validTip=$('\x3cdiv class\x3d"slwGridTip"\x3e\x3c/div\x3e');this.tipName="slwErrorTip"};SlwGrid.Validator.prototype={init:function(){var a=this,b=this.grid;b.table.after(a.validTip);b.table.find("tbody").on("mousemove.slwGridValidator",function(c){if(b.editable&&Slw.Event.checkHover(c,a.beforeEl))if(a.beforeEl=c.target,c=$(a.beforeEl),"TD"!=c[0].tagName&&(c=c.parent("td")),c.hasClass("error")){c.parent().index();c.index();var d=c.data(a.tipName);""!=d&&(a.validTip.css({left:0,top:0}),a.validTip.html(d),d=c.offset().left+c.outerWidth()-a.validTip.outerWidth(),c=c.offset().top+c.outerHeight()-a.validTip.outerHeight(),a.validTip.css({left:d,top:c}).show())}else a.validTip.hide()})},check:function(){var a=!0,b=this.grid,c=this.grid.getData(),d;for(d in b.editCols){var e=b.cfgHelper.getConfig(d);if(e&&e.name&&e.validator)for(index=0;index<c.length;index++){var f=Slw.Valid.check(e.validator,c[index][e.name]);f.result||(a=!1);this.setTip(e,index,f)}}return a},testCell:function(a,b,c){var d=this.grid,e=d.getCurConfig(b,c);e&&e.name&&e.validator&&(b=d.getDataIndex(b,c),d=d.curArray.getData(b,e.name),e=Slw.Valid.check(e.validator,d),this.setTdTip(a,e))},setTip:function(a,b,c){this.setTdTip(this.grid.getTdByIndex(b,a),c)},setTdTip:function(a,b){b.result?(a.removeClass("error"),a.data(this.tipName,"")):(a.addClass("error"),a.data(this.tipName,b.message))}}})(jQuery);