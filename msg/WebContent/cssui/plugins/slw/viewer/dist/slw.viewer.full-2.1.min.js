$.fn.slwViewer=$.fn.cssViewer=function(a){a=new SlwPlugins.SlwViewer(this,a);a.init();return a};var SlwViewer={};SlwPlugins.SlwViewer=function(a,b){this.version="slwViewer v2.1";this.defaults={picClass:"pic-element",picData:"data-original",picThumb:"src",picTitle:"alt",zoomRatio:.1,thumbW:40,thumbH:50,fitType:"fixed",loading:"cssui/plugins/slw/viewer/style/loading.gif"};this.option=$.extend(this.defaults,b);this.el=$(a);this.view=new SlwViewer.View(this);this.cmd=new SlwViewer.Cmd(this)};SlwPlugins.SlwViewer.prototype={init:function(){this.view.init();this.load()},load:function(){var a=this.option,b=this,c=this.el.find("."+a.picClass);0!=c.length&&(this.view.clear(),c.css({cursor:"pointer"}),c.each(function(c){var d=$(this),f={src:d.attr(a.picThumb),alt:d.attr(a.picTitle),url:d.attr(a.picData),rotate:0,scaleX:1,scaleY:1,index:c};Slw.Image.loadImage(f.url,function(a){f.naturalWidth=a.width;f.naturalHeight=a.height});b.view.addList(f);d.unbind("click.slwViewer");d.on("click.slwViewer",function(){b.view.show();b.view.view(c)})}))},reload:function(){this.load();this.view.isLoad&&this.view.load()}};SlwViewer.View=function(a){this.main=a;this.option=a.option;this.layer=$('\x3cdiv class\x3d"viewer-layer viewer-layeruuid"" style\x3d"display: none;"\x3e');this.container=$('\x3cdiv class\x3d"viewer-container viewer-in"\x3e');this.isLoad=this.isShow=!1;this.images=[];this.curIndex=-1;this.curImage=null;this.CLASS_SHOW="viewer-show";this.CLASS_ACTIVE="viewer-active";this.CLASS_TRANSITION="viewer-transition"};SlwViewer.View.prototype={init:function(){this.layer.append(this.container);this.canvas=$('\x3cdiv class\x3d"viewer-canvas"\x3e\x3c/div\x3e');this.footer=$('\x3cdiv class\x3d"viewer-footer"\x3e\x3c/div\x3e');this.tooltip=$('\x3cdiv class\x3d"viewer-tooltip"\x3e\x3c/div\x3e');this.button=$('\x3cdiv class\x3d"viewer-button viewer-close" data-action\x3d"mix"\x3e\x3c/div\x3e');this.container.append(this.canvas);this.container.append(this.footer);this.container.append(this.tooltip);this.container.append(this.button);this.initFooter();$("body").append(this.layer)},initFooter:function(){this.title=$('\x3cdiv class\x3d"viewer-title"\x3e\x3c/div\x3e');this.toolbar=$('\x3cul class\x3d"viewer-toolbar"\x3e\x3c/ul\x3e');this.navbar=$('\x3cdiv class\x3d"viewer-navbar"\x3e\x3c/div\x3e');this.footer.append(this.title);this.footer.append(this.toolbar);this.footer.append(this.navbar);this.toolbar.append('\x3cli class\x3d"viewer-zoom-in" data-action\x3d"zoom-in"\x3e\x3c/li\x3e\x3cli class\x3d"viewer-zoom-out" data-action\x3d"zoom-out"\x3e\x3c/li\x3e\x3cli class\x3d"viewer-one-to-one" data-action\x3d"one-to-one"\x3e\x3c/li\x3e\x3cli class\x3d"viewer-reset" data-action\x3d"reset"\x3e\x3c/li\x3e\x3cli class\x3d"viewer-prev" data-action\x3d"prev"\x3e\x3c/li\x3e\x3cli class\x3d"viewer-next" data-action\x3d"next"\x3e\x3c/li\x3e\x3cli class\x3d"viewer-rotate-left" data-action\x3d"rotate-left"\x3e\x3c/li\x3e\x3cli class\x3d"viewer-rotate-right" data-action\x3d"rotate-right"\x3e\x3c/li\x3e\x3cli class\x3d"viewer-flip-horizontal" data-action\x3d"flip-horizontal"\x3e\x3c/li\x3e\x3cli class\x3d"viewer-flip-vertical" data-action\x3d"flip-vertical"\x3e\x3c/li\x3e');this.list=$('\x3cul class\x3d"viewer-list"\x3e\x3c/ul\x3e');this.navbar.append(this.list)},initTooltip:function(a){var b=[this.CLASS_SHOW,this.CLASS_TRANSITION].join(" ");this.tooltip.text(Math.round(100*a.ratio)+"%");this.tooltip.addClass(b);this.tooltip.show().delay(1E3).fadeOut()},clear:function(){this.curIndex=-1;this.images=[];this.list.html("")},getLength:function(){return this.images.length},addList:function(a){this.images.push(a);this.list.append('\x3cli data-action\x3d"view" data-index\x3d"'+a.index+'" data-img\x3d"'+a.src+'"\x3e\x3c/li\x3e')},initLayer:function(){Slw.Utils.isIE()&&9>Slw.Utils.ieVersion()&&this.layer.css({"background-color":"#333",opacity:"1"});this.layer.css({width:Math.max(document.documentElement.scrollWidth,document.documentElement.clientWidth)+"px",height:Math.max(document.documentElement.scrollHeight,document.documentElement.clientHeight)+"px"});this.container.css({width:document.documentElement.clientWidth,height:document.documentElement.clientHeight});if(6==Slw.Utils.ieVersion()){var a=$(document).scrollTop+"px",b=$(document).scrollLeft+"px";this.container.css({"margin-top":a,"margin-left":b})}},initThumb:function(){var a=this.option;this.list.find("li").each(function(b){var c=$(this),d=c.attr("data-img");Slw.Image.loadImage(d,function(d){var e=$(d);e.attr("data-action","view");e.attr("data-index",b);Slw.Image.trumbImage(d,a);c.css({overflow:"hidden",width:a.thumbW-2+"px",height:a.thumbH-2+"px"});c.html(e)})})},initRender:function(){var a=this.option;this.initLayer();var b=(a.thumbW+4)*this.getLength();this.list.css({height:a.thumbH,width:b,marginLeft:(this.container.width()-b)/2});a=a.thumbH+40;this.canvas.css({width:this.container.width(),height:this.container.height()-a-5});this.imageToFit()},view:function(a){var b=this.option,c=this;a=Number(a)||0;if(!(c.curIndex==a||0>a||a>=c.getLength())){var d=c.images[a],e=c.list.find("li");-1!=c.curIndex&&e.eq(c.curIndex).removeClass(c.CLASS_ACTIVE);c.curIndex=a;e.eq(a).addClass(c.CLASS_ACTIVE);c.title.html(d.alt+" ("+d.naturalWidth+" \x26times; "+d.naturalHeight+")");a=$('\x3cimg src\x3d"'+b.loading+'" /\x3e');a.addClass(c.CLASS_TRANSITION);a.css({marginLeft:(c.canvas.width()-50)/2,marginTop:(c.canvas.height()-50)/2});c.canvas.html(a);Slw.Image.loadImage(d.url,function(a){c.curImage=$(a);c.curImage.addClass(c.CLASS_TRANSITION);c.imageToFit();c.canvas.html(c.curImage)})}},getImage:function(){return this.images[this.curIndex]},imageToFit:function(){if(!(0>this.curIndex)){var a=this.getImage(),b=a.naturalWidth,a=a.naturalHeight,c=b/a,d=this.canvas.width()/this.canvas.height(),e;c>d?(d=this.canvas.width(),e=d/c):(e=this.canvas.height()-20,d=c*e);this.main.cmd.zoomTo(d>b?b:d,e>a?a:e)}},load:function(){this.initThumb();this.initRender()},show:function(){this.isLoad||(this.isLoad=!0,this.load(),this.main.cmd.initEvent());this.isShow||(this.isShow=!0,this.layer.show())},hide:function(){this.isShow&&(this.isShow=!1,this.layer.hide())}};SlwViewer.Cmd=function(a){this.main=a;this.option=a.option;this.view=a.view;this.wheeling=this.iePosition=!1};SlwViewer.Cmd.prototype={initEvent:function(){var a=this;$(window).on("resize.slwViewer",function(b){a.view.initRender()});$(document).on("keydown.slwViewer",function(b){a.keydown(b)});a.view.container.on("click.slwViewer",function(b){a.click(b)});a.view.container.on("wheel.slwViewer mousewheel.slwViewer DOMMouseScroll.slwViewer",function(b){a.wheel(b)})},click:function(a){var b=this.view,c=this.option,d=b.getImage(),e=$(a.target),f=e.attr("data-action");a.preventDefault();switch(f){case "mix":b.hide();break;case "view":b.view(e.attr("data-index"));break;case "zoom-in":this.zoom(c.zoomRatio);break;case "zoom-out":this.zoom(-c.zoomRatio);break;case "one-to-one":this.zoomToNatural();break;case "reset":this.zoomToFit();break;case "prev":this.prev();break;case "next":this.next();break;case "rotate-left":this.rotate(-90);break;case "rotate-right":this.rotate(90);break;case "flip-horizontal":this.scaleX(d,-d.scaleX||-1);break;case "flip-vertical":this.scaleY(d,-d.scaleY||-1)}},keydown:function(a){var b=this.view;if(b.isShow){var c=this.option,d=b.getImage();switch(a.which){case 27:b.hide();break;case 37:a.ctrlKey||a.shiftKey?this.rotate(-90):this.prev();break;case 39:a.ctrlKey||a.shiftKey?this.rotate(90):this.next();break;case 38:a.ctrlKey||a.shiftKey?this.scaleY(d,-d.scaleY||-1):this.zoom(c.zoomRatio);break;case 40:a.ctrlKey||a.shiftKey?this.scaleX(d,-d.scaleX||-1):this.zoom(-c.zoomRatio);break;case 49:(a.ctrlKey||a.shiftKey)&&this.zoomToNatural()}}},wheel:function(a){var b=this.view;if(b.isShow){var c=this.option;b.getImage();var d=this,b=a.originalEvent||a,c=Number(c.zoomRatio)||.1,e=1;a.preventDefault();d.wheeling||(d.wheeling=!0,setTimeout(function(){d.wheeling=!1},50),b.deltaY?e=0<b.deltaY?1:-1:b.wheelDelta?e=-b.wheelDelta/120:b.detail&&(e=0<b.detail?1:-1),d.zoom(-e*c))}},prev:function(){var a=this.view;a.view(Math.max(a.curIndex-1,0))},next:function(){var a=this.view;a.view(Math.min(a.curIndex+1,a.getLength()-1))},rotate:function(a){this.iePosition=!this.iePosition;0==a&&(this.iePosition=!1);this.view.getImage().rotate+=a;this.renderImage()},scale:function(a,b,c){var d=!1;Slw.Utils.isUndefined(c)&&(c=b);b=Number(b);c=Number(c);isNumber(b)&&(a.scaleX=b,d=!0);isNumber(c)&&(a.scaleY=c,d=!0);d&&this.renderImage()},scaleX:function(a,b){this.scale(a,b,a.scaleY)},scaleY:function(a,b){this.scale(a,a.scaleX,b)},zoomToFit:function(){var a=this.view,b=a.getImage();b.rotate=0;b.scaleX=1;b.scaleY=1;this.rotate(0);a.imageToFit()},zoom:function(a){var b=this.view.getImage();a=Number(a);a=0>a?1/(1-a):1+a;this.zoomTo(b.width*a,b.height*a)},zoomTo:function(a,b){var c=this.view.getImage();c.width=a;c.height=b;c.ratio=c.width/c.naturalWidth;this.renderImage();this.view.initTooltip(c)},zoomToNatural:function(){var a=this.view.getImage();this.zoomTo(a.naturalWidth,a.naturalHeight)},getPosition:function(){var a=this.view,b=a.getImage(),c=b.width,d=b.height;this.iePosition&&Slw.Utils.isIE()&&9>Slw.Utils.ieVersion()&&(c=b.height,d=b.width);var e=a.canvas.width(),f=a.canvas.height();6==Slw.Utils.ieVersion()?(b.left=(e-c)/2+a.container.position().left,b.top=(f-d)/2+a.container.position().top):(b.left=(e-c)/2+$(document).scrollLeft(),b.top=(f-d)/2+$(document).scrollTop());return b},renderImage:function(){var a=this.view,b=this.getPosition(),c=this.getTransform(b);a.curImage.css({width:b.width,height:b.height,marginLeft:b.left,marginTop:b.top,transform:c});Slw.Utils.isIE()&&9>Slw.Utils.ieVersion()&&(b=this.getIeFilter(b),a.curImage.css("filter",b),a.curImage.css("-ms-filter",b))},getTransform:function(a){var b=[];b.push("rotate("+a.rotate+"deg)");b.push("scale("+a.scaleX+","+a.scaleY+")");return b.length?b.join(" "):"none"},getIeFilter:function(a){var b=a.rotate%360,c=2*Math.PI/360*(0<=b?b:360+b),b=Math.cos(c),c=Math.sin(c);return"filter: progid:DXImageTransform.Microsoft.Matrix(sizingMethod\x3d'auto expand',M11\x3d"+b*a.scaleX+", M12\x3d"+-c*a.scaleY+",M21\x3d"+c*a.scaleX+", M22\x3d"+b*a.scaleY+")"}};