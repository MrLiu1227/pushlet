///<jscompress sourcefile="crop.js" />
/*
 * $crop v1.0 Copyright(c) 2017.6 by CSS WangWeidong
 *////<jscompress sourcefile="method.js" />
/*
 * jqupload v1.0 2017.6 by CSS WangWeidong
 * 
 * default-methods: picMethod, liMethod, simplePicMethod, simpleLiMethod, tableMethod, tableMethod2
 *////<jscompress sourcefile="upload.js" />
/*
 * jqupload v1.0 2017.6 by CSS WangWeidong
 */(function(c){var a,d,g,b={},l={};$cropApp={checkPos:function(a){return isnull(l)?!0:l.x==a.x&&l.y==a.y&&l.width==a.width&&l.height==a.height?!1:!0},saveClick:function(){var a=g.getCropPos();if(0>a.x||0>a.y)return $css.alert("\u526a\u88c1\u6846\u4e0d\u8981\u8d85\u51fa\u56fe\u7247\uff01"),null;b.e=a;b.file=g.getFile();return null!=b.file||$cropApp.checkPos(a)?b:($css.closeDialog(),$css.tip("\u4fdd\u5b58\u6210\u529f"),null)},options:{extraPara:null,extraData:null,cropForm:null,cropPreview:null},init:function(b){var h=b.extraPara,Z=b.extraData;a=c(b.cropForm);d=a.find(b.cropPreview);l=Z;isnull(h.previewWidth)&&$css.alert("\u53c2\u6570\u914d\u7f6e\u9519\u8bef",$css.closeDialog());for(b=b=0;b<h.previewWidth.length;b++)a.find(".crop-preview.preview"+b).css({width:h.previewWidth[b]+"px",height:.01*Math.ceil(h.previewWidth[b]*h.height*100/h.width)+"px"});for(;3>b;b++)a.find(".preview"+b).remove();g=a.find(".crop-wrapper img").jqcropper({aspectRatio:h.width/h.height,preview:d,pos:l})}}})(jQuery);(function(){function c(a,c,b){d.addEventListener?a.addEventListener(c,b,!1):d.attachEvent&&a.attachEvent("on"+c,function(){b.call(a,d.event)})}var a=document,d=window,g=function(){var c=a.createElement("div");return function(a){c.innerHTML=a;a=c.childNodes[0];c.removeChild(a);return a}}(),b=function(){var a=0;return function(){return"ValumsIEUpload"+a++}}();IEUpload=function(c){this._input=null;this._submitting=!1;this._parentDialog=a.body;this._settings={action:"upload.action",name:"userfile",file:null,data:{},responseType:!1,onChange:function(a,c){},onSubmit:function(a,c){},onComplete:function(a,c){}};for(var b in c)this._settings[b]=c[b];this._input=this._settings.file;this.submit()};IEUpload.prototype={setData:function(a){this._settings.data=a},destroy:function(){this._input&&(this._input.parentNode&&this._input.parentNode.removeChild(this._input),this._input=null)},_createIframe:function(){var c=b(),d=g('\x3ciframe src\x3d"javascript:false;" name\x3d"'+c+'" /\x3e');d.id=c;d.style.display="none";a.body.appendChild(d);return d},submit:function(){var b=this,g=this._settings;this._input=g.file;if(""!==this._input.value){var h=this._input.value.replace(/.*(\/|\\)/,"");if(0!=g.onSubmit.call(this,h,getFileExt(h))){var d=this._createIframe(),t=this._createForm(d);t.appendChild(this._input);t.submit();a.body.removeChild(t);this._input=t=null;var O=!1;c(d,"load",function(c){if("javascript:'%3Chtml%3E%3C/html%3E';"==d.src||"javascript:'\x3chtml\x3e\x3c/html\x3e';"==d.src)O&&setTimeout(function(){a.body.removeChild(d)},0);else if(c=d.contentDocument?d.contentDocument:frames[d.id].document,!c.readyState||"complete"==c.readyState)if(!c.body||"false"!=c.body.innerHTML){var t;c.XMLDocument?t=c.XMLDocument:c.body?(t=c.body.innerHTML,g.responseType&&"json"==g.responseType.toLowerCase()&&(c.body.firstChild&&"PRE"==c.body.firstChild.nodeName.toUpperCase()&&(t=c.body.firstChild.firstChild.nodeValue),t=t?window.eval("("+t+")"):{})):t=c;g.onComplete.call(b,h,t);O=!0;d.src="javascript:'\x3chtml\x3e\x3c/html\x3e';"}})}else a.body.removeChild(this._input),this._input=null}},_createForm:function(c){var b=this._settings,h=g('\x3cform method\x3d"post" enctype\x3d"multipart/form-data"\x3e\x3c/form\x3e');h.style.display="none";h.action=b.action;h.target=c.name;a.body.appendChild(h);for(var d in b.data)c=a.createElement("input"),c.type="hidden",c.name=d,c.value=b.data[d],h.appendChild(c);return h}}})(jQuery);(function(c,a,d){c.jquploadUtil=c.extend({},{getIconImg:function(a,b){return'\x3cimg title\x3d"'+getFullName(a)+'" src\x3d"cssui/plugins/cssuploader/images/'+b+"/"+c.file.getIcon(a.fileExt)+'" /\x3e'},getUrlImg:function(a){var c="defaultImageId"==a.id?"":"."+a.fileExt;return'\x3cimg class\x3d"pic-element"  data-original\x3d"'+a.fileUrlFull+'" title\x3d"'+getFullName(a)+'" src\x3d"'+a.fileUrlFull+c+'" /\x3e'},getUrl:function(a){return"defaultImageId"==a.id?"":a.fileUrlFull+"."+a.fileExt},getLocalImg:function(a,c){if(c.type.match("image/*")&&"undefined"!==typeof FileReader){var d=new FileReader;d.onload=function(c){a.attr("src",c.target.result)};d.readAsDataURL(c)}}},c.jquploadUtil)})(jQuery);function isnull(c){return null==c||""==c||"undefined"==c}function uuid(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var a=16*Math.random()|0;return("x"==c?a:a&3|8).toString(16)})}function getFileName(c){return c.replace(/.*(\/|\\)/,"")}function getFileExt(c){return c.toLowerCase().split(".").pop()}function getFullName(c){var a=c.fileName;isnull(c.fileExt)||(a+="."+c.fileExt);return a}var picMethod={name:"picTemplate",sortable:!0,dotFlag:!0,imageFlag:!0,getTemplate:function(c){return c='\x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e\x3cdiv class\x3d"jqupload-container"  \x3e\x3cul class\x3d"sortable"\x3e\x3c/ul\x3e\x3c/div\x3e'},addFile:function(c,a,d,g){var b=a.id,l=c.find("ul"),b='\x3cli id\x3d"'+b+'" class\x3d"jquploadRow"\x3e\x3cdiv class\x3d"imgPreview"\x3e\x3cdiv class\x3d"details"\x3e'+('\t\t\x3cdiv class\x3d"default-file-name"\x3e'+getFullName(a)+"\x3c/div\x3e"),b=b+('\t\t\x3cdiv class\x3d"default-file-size"\x3e'+$.file.getFileSize(a.fileSize)+"\x3c/div\x3e"),b="pic"==a.category?b+('\t\t\x3cdiv class\x3d"iconCell"\x3e'+$.jquploadUtil.getUrlImg(a)+"\x3c/div\x3e"):b+('\t\t\x3cdiv class\x3d"iconCell"\x3e'+$.jquploadUtil.getIconImg(a,256)+"\x3c/div\x3e");g.readonly||(b+='\t\x3cdiv class\x3d"statusCell"\x3e\x3c/div\x3e');b+='\t\t\x3cdiv class\x3d"messageCell"\x3e\x3c/div\x3e';b+='\t\t\x3cdiv class\x3d"toolsCell"\x3e\x3c/div\x3e';b+='\t\t\x3cdiv class\x3d"successMark"\x3e\x3ci class\x3d"fa fa-check"\x3e \x3c/i\x3e\x3c/div\x3e';b+='\t\t\x3cdiv class\x3d"dangerMark"\x3e\x3ci class\x3d"fa fa-close"\x3e \x3c/i\x3e\x3c/div\x3e';b+="\t\x3c/div\x3e\x3c/div\x3e\x3c/li\x3e";b=$(b);b.attr("status",d);l.prepend(b);isIE6&&b.css({width:g.width+"px",height:g.height+"px"});b.find(".details").css({width:g.width+"px",height:g.height+"px","margin-bottom":g.bottom?"22px":"0px"});b.find(".statusCell").css({top:g.height+"px"});isIE&&b.css({"margin-bottom":"5px"});g.bottom||b.find(".default-file-size").css("display","none");1==g.fileNumber&&"center-block"==g.btnAlign&&l.find("li").css("float","none");g.readonly||1!=g.fileNumber||"defaultImageId"!=a.id||(d=b.find("img"),d.css("cursor","pointer"),d.click(function(){c.find("input[name\x3d'"+o.fileName+"']").click()}));null!=a.file&&$.jquploadUtil.getLocalImg(b.find("img"),a.file)}},simplePicMethod={name:"simplePicMethod",sortable:!1,dotFlag:!1,imageFlag:!0,background:!0,getTemplate:function(c){return'\x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e\x3cdiv class\x3d"jqupload-container"\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e'},addFile:function(c,a,d,g){var b=a.id,l=c.find("ul"),b='\x3cli id\x3d"'+b+'" class\x3d"jquploadRow"\x3e\t  \x3cspan class\x3d"statusCell"\x3e\x3c/span\x3e',b=b+'\t\t\x3cspan class\x3d"toolsCell"\x3e\x3c/span\x3e',b=b+"\t\x3c/li\x3e",b=$(b);b.attr("status",d);l.prepend(b);simplePicMethod.setBackground(c,a,g)},setBackground:function(c,a,d){var g="defaultImageId"==a.id?d.defaultBackground:"url("+$.jquploadUtil.getUrl(a)+")";c=c.find(".jquploadButton");(isIE6||isIE7||isIE8)&&"defaultImageId"==a.id?c.css({background:"none",filter:d.defaultFilter}):c.css({"background-image":g,"background-size":d.width+"px "+d.height+"px",filter:"none"})}},simpleLiMethod={name:"simpleLiMethod",sortable:!1,dotFlag:!1,getTemplate:function(c){return'\x3cdiv class\x3d"jqupload-container pull-right"\x3e\x3cul\x3e\x3c/ul\x3e\x3c/div\x3e'},addFile:function(c,a,d,g){a=a.id;c=c.find("ul");a='\x3cli id\x3d"'+a+'" class\x3d"jquploadRow"\x3e\t  \x3cspan class\x3d"statusCell"\x3e\x3c/span\x3e';a+='\t\t\x3cspan class\x3d"toolsCell"\x3e\x3c/span\x3e';a+="\t\x3c/li\x3e";a=$(a);a.attr("status",d);c.prepend(a)}},liMethod={name:"liTemplate",sortable:!0,dotFlag:!0,getTemplate:function(c){return c='\x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e\x3cdiv class\x3d"jqupload-container"\x3e\x3cul class\x3d"sortable"\x3e\x3c/ul\x3e\x3c/div\x3e'},addFile:function(c,a,d,g){var b=a.id;c=c.find("ul");b='\x3cli id\x3d"'+b+'" class\x3d"jquploadRow"\x3e';b=g.fileIcon?b+('\t\x3cspan class\x3d"iconCell"\x3e'+$.jquploadUtil.getIconImg(a,56)+"\x3c/span\x3e"):b+('\t\x3cspan class\x3d"numCell"\x3e'+(c.find("li").length+1)+".\x3c/span\x3e");b+='\t\t\x3cspan class\x3d"messageCell"\x3e\x3cspan class\x3d"default-file-name"\x3e'+getFullName(a)+'\x3c/span\x3e \x3cspan class\x3d"default-file-size"\x3e('+$.file.getFileSize(a.fileSize)+")\x3c/span\x3e\x3c/span\x3e";g.readonly||(b+='\t\x3cspan class\x3d"statusCell"\x3e\x3cspan class\x3d"label label-info"\x3e'+(1==d?"\u52a0\u8f7d":"\u521d\u59cb")+"\u6210\u529f\x3c/span\x3e\x3c/span\x3e");b+='\t\t\x3cspan class\x3d"toolsCell"\x3e\x3c/span\x3e\t\x3c/li\x3e';a=$(b);a.attr("status",d);c.prepend(a)}},tableMethod2={name:"tableTemplate2",sortable:!1,dotFlag:!1,getTemplate:function(c){var a;a='\x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e\x3cdiv class\x3d"jqupload-container"\x3e\t\x3ctable class\x3d"table table-bordered table-nostriped"\x3e';a+="\t\t\x3cthead\x3e\x3ctr\x3e";a+='\t\t\x3cth width\x3d"45px" class\x3d"firstCell"\x3e\u7c7b\u578b\x3c/th\x3e';a+="\t\t\x3cth\x3e\u6587\u4ef6\u540d\u79f0\x3c/th\x3e";a+='\t\t\x3cth width\x3d"'+(25+18*((c.readonly?1:3)+c.buttons.length))+'px"\x3e\u64cd\u4f5c\x3c/th\x3e';a+="\t\x3c/table\x3e";return a+="\x3c/div\x3e"},addFile:function(c,a,d,g){var b=a.id,l=c.find("table");c=l[0].insertRow(1);c.id=b;c.className="jquploadRow";c.setAttribute("status",d);var q=0,b=c.insertCell(q++);g.fileIcon?(b.className="iconCell",b.innerHTML=$.jquploadUtil.getIconImg(a,56)):(b.className="numCell",l.find(".firstCell").html("\u5e8f\u53f7"),b.innerHTML=l[0].rows.length-1);b=c.insertCell(q++);b.className="text-left messageCell";a='\x3cspan class\x3d"default-file-name"\x3e'+getFullName(a)+'\x3c/span\x3e \x3cspan class\x3d"default-file-size"\x3e('+$.file.getFileSize(a.fileSize)+")\x3c/span\x3e";g.readonly||(a+='\x3cspan class\x3d"statusCell"\x3e\x3cspan class\x3d"label label-info"\x3e'+(1==d?"\u52a0\u8f7d":"\u521d\u59cb")+"\u6210\u529f\x3c/span\x3e\x3c/span\x3e");b.innerHTML=a;b=c.insertCell(q++);b.className="toolsCell";b.innerHTML=""}},tableMethod={name:"tableTemplate",sortable:!1,dotFlag:!1,getTemplate:function(c){var a;a='\x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e\x3cdiv class\x3d"jqupload-container"\x3e\t\x3ctable class\x3d"table table-bordered table-nostriped"\x3e';a+="\t\t\x3cthead\x3e\x3ctr\x3e";a+='\t\t\x3cth width\x3d"45px" class\x3d"firstCell"\x3e\u7c7b\u578b\x3c/th\x3e';a+="\t\t\x3cth\x3e\u6587\u4ef6\u540d\u79f0\x3c/th\x3e";c.readonly||(a+='\t\t\x3cth width\x3d"70px"\x3e\u72b6\u6001\x3c/th\x3e');a+='\t\t\x3cth width\x3d"'+(25+18*((c.readonly?1:3)+c.buttons.length))+'px"\x3e\u64cd\u4f5c\x3c/th\x3e';a+="\t\t\x3c/tr\x3e\x3c/thead\x3e";a+="\t\x3c/table\x3e";return a+="\x3c/div\x3e"},addFile:function(c,a,d,g){var b=a.id;c=c.find("table");var l;l=c[0].insertRow(1);l.id=b;l.className="jquploadRow";l.setAttribute("status",d);var q=0,b=l.insertCell(q++);g.fileIcon?(b.className="iconCell",b.innerHTML=$.jquploadUtil.getIconImg(a,56)):(b.className="numCell",c.find(".firstCell").html("\u5e8f\u53f7"),b.innerHTML=c[0].rows.length-1);b=l.insertCell(q++);b.className="text-left messageCell";b.innerHTML='\x3cspan class\x3d"default-file-name"\x3e'+getFullName(a)+'\x3c/span\x3e \x3cspan class\x3d"default-file-size"\x3e('+$.file.getFileSize(a.fileSize)+")\x3c/span\x3e";g.readonly||(b=l.insertCell(q++),b.className="statusCell",b.innerHTML='\x3cspan class\x3d"label label-info"\x3e'+(1==d?"\u52a0\u8f7d":"\u521d\u59cb")+"\u6210\u529f\x3c/span\x3e");b=l.insertCell(q++);b.className="toolsCell";b.innerHTML=""}};(function(c){c.fn.jqupload=function(a){a=c.extend({btnTitle:"\u8bf7\u9009\u62e9\u6587\u4ef6",btnAlign:"pull-left",btnClass:"btn-primary btn-sm",btnOnTop:!0,btnSortClass:"btn-default btn-sm",readonly:!1,confirm:!0,sortable:!1,sortSaveAuto:!1,fileIcon:!0,uploadUrl:"uploadAttachment.action",getUrl:"getAttachment.action",getCropUrl:"getCropAttachment.action",cropUrl:"cropAttachment.action",updUrl:"updAttachment.action",delUrl:"delAttachment.action",sortUrl:"sortAttachment.action",loadUrl:"loadAttachment.action",downUrl:"downloadAttachment.action",extraData:{tableName:"",tableKey:"",tableUuid:""},fileLength:1E4,fileNumber:1,allowedTypes:"*",fileExt:null,fileName:"file",dataType:"json",method:"POST",uploadType:"sync",imgPreview:!1,width:140,height:180,bottom:!0,fileNameShow:!1,totalInfoShow:!0,defaultImage:"cssui/plugins/jqupload/blank.gif",style:liMethod,onload:null,extraEvent:null,extraPara:null,extraButton:null,buttons:[]},a);var d={},g=this;if(0!=c(this).length){var b=1<c(this).length||isnull(a.extraData.tableUuid);if(b){var l=[];this.each(function(){var a=c(this).attr("data-id");l.push(a);d[a]=[]});a.extraData.tableUuid=l.toString()}else d[a.extraData.tableUuid]=[];c.post(a.loadUrl,a.extraData,function(c){switch(c.result){case 0:var b=c.msg.data.config;a.fileLength=b.fileLength;a.fileNumber=b.fileNumber;a.fileExt=b.fileExt;a.extraPara=b.extraPara;c=c.msg.data.list[0].attachments;if(c instanceof Array)for(b=0;b<c.length;b++){var g=c[b].tableUuid;d[g].push(c[b])}else isnull(c)||(g=c.tableUuid,d[g].push(c));isnull(a.extraPara)||("pic"==a.extraPara.type?(a.width=a.extraPara.width,a.height=a.extraPara.height,a.allowedTypes="image/jpg,image/jpeg,image/png,image/gif",a.imgPreview=1==a.extraPara.imgPreview):isnull(a.extraPara)||"crop"!=a.extraPara.type||(a.width=a.extraPara.width,a.height=a.extraPara.height));q();break;default:$css.alert(c.msg)}},a.dataType);var q=function(){g.each(function(){var h=c(this);c(document);var g={},g=c.extend(g,a.extraData);b&&(g.tableUuid=h.attr("data-id"));var l=0,q=0;h.addClass("jqUploadTemplate");h.addClass(a.style.name);var x=0,F,u={},n={},v=[],y=c('\x3cdiv class\x3d"uploadInfo"\x3e\x3c/div\x3e'),z=c('\x3cdiv class\x3d"pull-left totalStatus"\x3e\x3c/div\x3e'),w=c('\x3cdiv class\x3d"btnUpload '+a.btnAlign+'"\x3e\x3c/div\x3e'),p=c('\x3cbutton type\x3d"button" class\x3d"jquploadButton btn '+a.btnClass+" "+a.btnAlign+'"\x3e \x3ci class\x3d"fa fa-folder-open-o"\x3e\x3c/i\x3e '+a.btnTitle+"\x3c/button\x3e"),P=c('\x3cbutton type\x3d"button" class\x3d"btnSort btn '+a.btnSortClass+" "+a.btnAlign+'"\x3e \x3ci class\x3d"fa fa-arrows-v"\x3e\x3c/i\x3e \u4fdd\u5b58\u987a\u5e8f\x3c/button\x3e'),Q={getFiles:function(){return h.find(".jquploadRow")},getTotalFiles:function(){return l},getSuccessFiles:function(){return q},getFileInfo:function(c){c=n[c];isnull(a.extraPara)||(c.extraPara=a.extraPara);return c}},r={onInit:function(c){if(0<c.length){l=c.length;for(var b=0;b<c.length;b++){var m=c[b];m.id=uuid();m.file=null;n[m.id]=m;a.style.addFile(h,m,1,a);a.readonly?A(m.id,3):(B(),A(m.id,1));C(m.id);D()}}else R();G();H();if(!isnull(a.onload))a.onload()},onNewFile:function(c){1==a.fileNumber&&a.style.imageFlag&&h.find("li").remove();a.style.addFile(h,c,0,a);B();C(c.id);D()},onFileTypeError:function(a,c){r.onUploadError(a,"\u4e0d\u5141\u8bb8\u4e0a\u4f20\u8be5\u7c7b\u578b\u6587\u4ef6")},onFileExtError:function(a,c,b){r.onUploadError(a,"\u6587\u4ef6\u6269\u5c55\u540d(."+b+")\u7c7b\u578b\u4e0d\u5141\u8bb8")},onFileSizeError:function(a,b,m){r.onUploadError(a,"\u6587\u4ef6\u5927\u5c0f\u4e0d\u80fd\u8d85\u8fc7"+c.file.getFileSize(m))},onUploadSuccess:function(b,f){if(0==f.result){c("#"+b).attr("status",1);S(b,"success","\u4e0a\u4f20\u6210\u529f");B();n[b].uuid=f.msg.uuid;n[b].fileUrlFull=f.msg.fileUrlFull;n[b].time=f.msg.time;n[b].userId=f.msg.userId;n[b].file=null;if(isIE6||isIE7||isIE8||isIE9){n[b].fileSize=f.msg.fileSize;var m=c("#"+b).find(".default-file-size");if(m){var k=m.html();isnull(k)?m.html(c.file.getFileSize(n[b].fileSize)):m.html("("+c.file.getFileSize(n[b].fileSize)+")")}}A(b,1);C(b);a.style.imageFlag&&(m=f.msg.fileUrlFull+"."+f.msg.fileExt,1==a.style.background?p.css({background:"#fff url("+m+") no-repeat"}):(k=c("#"+b).find(".iconCell img"),k.attr("src",m),k.attr("class","pic-element"),k.attr("data-original",f.msg.fileUrlFull),H()))}else r.onUploadError(b,f.msg)},onUploadError:function(b,f){c("#"+b).attr("status",2);var m=c('\x3ccode class\x3d"tipsCell" text-red"\x3e'+f+"\x3c/code\x3e"),k=c("#"+b).find(".messageCell");k.find(".tipsCell").remove();k.append(m);S(b,"danger","\u4e0a\u4f20\u5931\u8d25");isnull(f);1==a.fileNumber&&a.style.imageFlag&&$css.alert(f);A(b,2)}},B=function(){l=h.find(".jquploadRow").length;q=h.find(".jquploadRow[status\x3d1]").length;z.html("\u5b8c\u6210/\u603b\u6570\uff1a"+q+"/"+l)},C=function(b){if(null!=a.extraEvent){var f=c("#"+b).find(".default-file-name, img");f&&(f.unbind(),f.css("cursor","pointer"),f.click(function(){var c=Q.getFileInfo(b);a.extraEvent(c)}))}},S=function(b,f,m){var k=c("#"+b).find(".statusCell");if(a.style.imageFlag){k.hide();var k=c("#"+b).find("."+f+"Mark"),d=c("#"+b).find(".tipsCell").html(),d=m+(isnull(d)?"":"\uff1a"+d);k.attr("title",d);"danger"==f?(k.css("cursor","pointer"),k.show(),k.click(function(){T(b)})):k.show().delay(8E3).hide(1E3)}else k.html(""),k.append('\x3cspan class\x3d"label label-'+f+'"\x3e'+m+"\x3c/span\x3e")},U=function(b){var f=c("#"+b).find(".statusCell");a.style.imageFlag?(f.html('\x3cdiv class\x3d"progress progress-xs"\x3e\x3cdiv class\x3d"progress-bar progress-bar-success progress-bar-striped" role\x3d"progressbar" \x3e0%\x3c/div\x3e\x3c/div\x3e'),f.show()):f.html('\x3cdiv class\x3d"progress"\x3e\x3cdiv class\x3d"progress-bar" role\x3d"progressbar" style\x3d"min-width:3em;"\x3e0%\x3c/div\x3e\x3c/div\x3e');c("#"+b).find(".toolsCell").html("");c("#"+b).find(".tipsCell").remove()},V=function(b,f){var m=c("#"+b).find("div.progress-bar");m.width(f);a.style.imageFlag?m.html(""):m.html(f)},A=function(b,f){var m=c("#"+b).find(".toolsCell"),k=c('\x3cdiv class\x3d"tools"\x3e\x3c/div\x3e'),d=c('\x3ci class\x3d"fa fa-trash-o" title\x3d"\u5220\u9664"\x3e \x3c/i\x3e'),g=c('\x3ci class\x3d"fa fa-edit" title\x3d"\u7f16\u8f91"\x3e \x3c/i\x3e'),h=c('\x3ci class\x3d"fa fa-download" title\x3d"\u4e0b\u8f7d"\x3e \x3c/i\x3e'),l=c('\x3ci class\x3d"fa fa-reply" title\x3d"\u91cd\u4f20"\x3e \x3c/i\x3e');m.html("").append(k);1==f?(k.append(g),k.append(h),k.append(d)):2==f?(k.append(l),k.append(d)):3==f&&k.append(h);d.click(function(){T(b)});g.click(function(){aa(b)});h.click(function(){ba(b,2)});l.click(function(){b in n&&I(n[b])});c.each(a.buttons,function(a,f){var m=c('\x3ci class\x3d"'+f.icon+'" title\x3d"'+f.title+'"\x3e \x3c/i\x3e');k.append(m);f.action&&m.click(function(){f.action.call(this,Q.getFileInfo(b))})})},R=function(){if(1==a.fileNumber&&a.style.imageFlag){var c=n.defaultImageId;isnull(c)&&(c={id:"defaultImageId",file:null,fileName:"",fileSize:"-1",category:"pic"},c.fileUrlFull=a.defaultImage,n[c.id]=c);a.style.addFile(h,c,1,a);(isIE6||isIE7||isIE8||isIE9)&&J()}},ca=function(){var b={};b.x=Math.round(u.e.x);b.y=Math.round(u.e.y);b.width=u.e.width;b.height=u.e.height;b.tSessionId=(new Date).valueOf();b=c.param(c.extend(b,g));c.post(a.cropUrl,b,function(c){0==c.result?(1==a.style.background?a.style.setBackground(h,c.msg,a):h.find(".iconCell img").attr("src",c.msg.fileUrlFull+"."+c.msg.fileExt),$css.tip("\u4fdd\u5b58\u6210\u529f\uff01")):$css.alert(c.msg)},a.dataType)},da=function(b){U(b.id);var f=new FormData;f.append(a.fileName,b.file);f.append("name",b.file.name);f.append("fileType",b.file.type);isnull(a.extraPara)||"crop"!=a.extraPara.type?a.style.imageFlag&&(f.append("width",a.width),f.append("height",a.height)):(f.append("x",Math.round(u.e.x)),f.append("y",Math.round(u.e.y)),f.append("width",u.e.width),f.append("height",u.e.height));c.each(g,function(a,c){f.append(a,c)});c.ajax({url:a.uploadUrl,type:a.method,dataType:a.dataType,data:f,cache:!1,contentType:!1,processData:!1,forceSync:!1,xhr:function(){var a=c.ajaxSettings.xhr();a.upload&&a.upload.addEventListener("progress",function(a){var c=0,f=a.loaded||a.position,m=a.total||e.totalSize;a.lengthComputable&&(c=Math.ceil(f/m*100));V(b.id,c+"%")},!1);return a},success:function(a,c,f){r.onUploadSuccess.call(h,b.id,a)},error:function(a,c,f){r.onUploadError.call(h,b.id,f)},complete:function(c,b){"sync"==a.uploadType?K():G()}})},H=function(){1==a.imgPreview&&h.cssViewer({uuid:h.attr("id"),picClass:"pic-element",picData:"data-original",picTitle:"title"})},G=function(){!a.readonly&&a.sortable&&a.style.sortable&&(h.find(".sortable").sortable("destroy"),h.find(".sortable").sortable(),h.find(".sortable").css("cursor","move"),h.find(".sortable").on("dragend",function(){D();a.sortSaveAuto&&L()}))},L=function(){var b="";h.find("li").each(function(){var a=c(this).attr("id");isnull(a)||(a=n[c(this).attr("id")],b+=a.uuid+",")});if(!isnull(b)){var f={};f.sortStr=b;f.tSessionId=(new Date).valueOf();f=c.param(c.extend(f,g));c.post(a.sortUrl,f,function(c){0==c.result?a.sortSaveAuto||$css.tip("\u987a\u5e8f\u4fdd\u5b58\u6210\u529f\uff01"):$css.alert(c.msg)},a.dataType)}},I=function(b){var f=b.file;if("*"!=a.allowedTypes&&0>a.allowedTypes.indexOf(f.type))r.onFileTypeError(b.id,f);else{if(null!=a.fileExt&&"*"!=a.fileExt){var d=a.fileExt.toLowerCase().split(","),g=getFileExt(f.name);if(0>c.inArray(g,d)){r.onFileExtError(b.id,f,g);return}}if(0<a.fileLength&&f.size>1024*a.fileLength)r.onFileSizeError(b.id,f,1024*a.fileLength);else da(b)}},K=function(){x<v.length?I(v[x++]):(G(),p.attr("disabled",!1))},W=function(a,c){var b={};b.id=uuid();b.fileExt=getFileExt(c.name);b.fileName=c.name.substring(0,c.name.lastIndexOf("."));b.fileSize=c.size;b.file=c;n[b.id]=b;v[a]=b;r.onNewFile(b)},ea=function(b){var f=c(b).val(),d=getFileName(f),k={};k.id=uuid();k.fileExt=getFileExt(f);k.fileName=d.substring(0,d.lastIndexOf("."));k.fileSize=0;k.file=null;n[k.id]=k;r.onNewFile(k);f={};(isnull(a.extraPara)||"crop"!=a.extraPara.type)&&a.style.imageFlag&&(f.width=a.width,f.height=a.height);f.ie="ie8";var f=c.extend(f,g),h=null;new IEUpload({action:a.uploadUrl,name:a.fileName,data:f,file:b,responseType:"json",onSubmit:function(b,f){if(null!=a.fileExt&&"*"!=a.fileExt){var d=a.fileExt.toLowerCase().split(",");f=k.fileExt;if(0>c.inArray(f,d))return r.onFileExtError(fm.id,file,f),!1}U(k.id);var g=10;h=setInterval(function(){g+=Math.ceil((100-g)/10);98<g&&clearInterval(h);V(k.id,g+"%")},500)},onComplete:function(c,b){clearInterval(h);r.onUploadSuccess.call(this,k.id,b);isnull(a.extraPara)||"crop"!=a.extraPara.type?J():X(!0)}})},D=function(){if(!a.fileIcon){var b=1;h.find(".numCell").each(function(){c(this).html(b++ +(a.style.dotFlag?".":""))})}},T=function(b){var f=c("#"+b),d=function(){var d=function(){f.remove();delete n[b];B();D();R();H()};if("1"==f.attr("status")){var g={};g.ids=n[b].uuid;g.tSessionId=(new Date).valueOf();g=c.param(g);c.post(a.delUrl,g,function(a){0==a.result?d():$css.alert(a.msg)},a.dataType)}else d()};a.confirm&&"1"==f.attr("status")?$css.confirm("\u786e\u5b9a\u8981\u5220\u9664\u6587\u4ef6\u5417\uff1f",d):d()},aa=function(b){var f=n[b],d={};d.url=a.getUrl;d.data={uuid:f.uuid};d.rel="attachmentRename";d.title="\u91cd\u547d\u540d";d.callback=function(){var d=c("#getAttachmentForm");d.find("button").click(function(){if(!d.valid())return!1;var g=d.find("#fileName").val();c.post(a.updUrl,d.serialize(),function(a){0==a.result?(closeDialog(),$css.tip("\u4fdd\u5b58\u6210\u529f\uff01"),f.fileName=g,n[b]=f,c("#"+b).find(".default-file-name").html(getFullName(f)),C(b)):$css.alert(a.msg)},a.dataType)})};$css.openDialog(d)},ba=function(b,f){var d=function(){var d={};d.uuid=n[b].uuid;d.mod=f;d.tSessionId=(new Date).valueOf();var d=c.param(d),g=c("#hiddenformwwd");0==g.length&&(c("body").append('\x3cform id\x3d"hiddenformwwd" target\x3d"_blank" method\x3d"post"\x3e\x3c/form\x3e'),g=c("#hiddenformwwd"));g.attr("action",a.downUrl+"?"+d);g.submit()},g=c("#"+b).find(".default-file-name").html(),g=isnull(g)?"":"\u201c"+g+"\u201d";a.confirm?$css.confirm("\u786e\u5b9a\u8981\u4e0b\u8f7d\u6587\u4ef6"+g+"\u5230\u672c\u5730\u5417\uff1f",d):d()},E=function(a){return isNumber(a)?a+"px":a},Y=function(c){if(isIE6||isIE7||isIE8||isIE9){var b=19.001*p.outerWidth()/100,d=p.position();c.css({position:"absolute",display:"",width:E(p.outerWidth()),height:E(p.outerHeight()),left:E(d.left),cursor:"pointer",color:"transparent","font-size":b+"px","z-index":201707,overflow:"hidden",opacity:0});1==a.fileNumber&&"center-block"==a.btnAlign&&1!=a.style.background&&c.css({"margin-top":E(-p.outerHeight())});p.unbind();p.hover(function(){Y(c)})}},J=function(){var b=w.find("input[name\x3d'"+a.fileName+"']");0<b.length&&b.remove();b=c('\x3cinput type\x3d"file" name\x3d"'+a.fileName+'" style\x3d"display:none" unselectable\x3d"on" '+("*"!=a.allowedTypes?'accept\x3d"'+a.allowedTypes+'"':"")+(1!=a.fileNumber?' multiple\x3d"multiple"':" ")+"/\x3e");p.after(b);Y(b);b.click(function(b){if(0<a.fileNumber&&l>=a.fileNumber)return $css.alert("\u6700\u591a\u5141\u8bb8\u4e0a\u4f20 "+a.fileNumber+" \u4e2a\u9644\u4ef6\uff01"),b.stopPropagation(),!1});b.on("change",function(b){p.attr("disabled",!0);if(isIE6||isIE7||isIE8||isIE9)ea(this);else{F=b.target.files;v=[];for(b=0;b<F.length&&!(0<a.fileNumber&&l>=a.fileNumber);b++)W(b,F[b]);if("sync"==a.uploadType)x=0,K();else{for(b=0;b<v.length;b++)I(v[b]);p.attr("disabled",!1)}}c(this).val("")});p.attr("disabled",!1);return b},N=function(){M();var b=J();a.style.sortable&&a.sortable&&!a.sortSaveAuto&&(w.append(P),P.click(function(){a.confirm?$css.confirm("\u786e\u5b9a\u8981\u4fdd\u5b58\u5f53\u524d\u6392\u5e8f\u5417\uff1f",L):L()}));isIE6||isIE7||isIE8||isIE9||p.click(function(){b.click()})},X=function(b){isIE6||isIE7||isIE8||isIE9?(p.unbind(),p.attr("disabled",!1)):M();p.click(function(){var b={};b.url=a.getCropUrl;b.data=g;b.rel="getCropFile";b.title="\u56fe\u7247\u526a\u88c1";b.callback=function(){c("#getCropAttachmentForm").find(".crop-save").click(function(){u=$cropApp.saveClick();isnull(u)||($css.closeDialog(),v=[],isnull(u.file)?ca():(W(0,u.file),x=0,K()))})};$css.openDialog(b)});b&&p.click()},M=function(){w.append(p);1==a.style.background&&(a.defaultBackground=p.css("background-image"),a.defaultFilter=p.css("filter"),p.css({width:a.width,height:a.height}))};(function(){h.html("");"pull-right"==a.btnAlign?y.append(z).append(w).append('\x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e'):y.append(w).append(z).append('\x3cdiv style\x3d"clear: both;"\x3e\x3c/div\x3e');a.btnOnTop?(a.readonly||h.append(y),h.append(c(a.style.getTemplate(a)))):(h.append(c(a.style.getTemplate(a))),a.readonly||h.append(y));a.totalInfoShow||z.hide();var b=d[g.tableUuid];isnull(a.extraPara)?a.readonly||N():"pic"==a.extraPara.type?a.readonly||N():isnull(a.extraPara)||"crop"!=a.extraPara.type||a.readonly||(0==b.length&&(isIE6||isIE7||isIE8||isIE9)?N():(M(),X(!1)));r.onInit(b)})()})}}}})(jQuery);